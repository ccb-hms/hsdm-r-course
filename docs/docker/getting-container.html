<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Research Design and Analysis – getting-container</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Research Design and Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../readings/readings.html" rel="" target="">
 <span class="menu-text">Readings</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../session-materials/sessions.html" rel="" target="">
 <span class="menu-text">In-Class Materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../exercises/exercises.html" rel="" target="">
 <span class="menu-text">Exercises</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources/resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-get-container" id="toc-sec-get-container" class="nav-link active" data-scroll-target="#sec-get-container">Downloading and Running NHANES Docker Container</a>
  <ul class="collapse">
  <li><a href="#downloading-the-container" id="toc-downloading-the-container" class="nav-link" data-scroll-target="#downloading-the-container">Downloading the container</a>
  <ul class="collapse">
  <li><a href="#option-1-using-docker-desktop" id="toc-option-1-using-docker-desktop" class="nav-link" data-scroll-target="#option-1-using-docker-desktop">Option 1: Using Docker Desktop</a></li>
  <li><a href="#option-2-using-the-command-line" id="toc-option-2-using-the-command-line" class="nav-link" data-scroll-target="#option-2-using-the-command-line">Option 2: Using the command line</a></li>
  </ul></li>
  <li><a href="#running-the-container" id="toc-running-the-container" class="nav-link" data-scroll-target="#running-the-container">Running the container</a>
  <ul class="collapse">
  <li><a href="#details" id="toc-details" class="nav-link" data-scroll-target="#details">Details</a></li>
  <li><a href="#confirming-that-the-container-is-running" id="toc-confirming-that-the-container-is-running" class="nav-link" data-scroll-target="#confirming-that-the-container-is-running">Confirming that the container is running</a></li>
  <li><a href="#inspecting-the-container" id="toc-inspecting-the-container" class="nav-link" data-scroll-target="#inspecting-the-container">Inspecting the container</a></li>
  </ul></li>
  <li><a href="#connecting-to-the-container" id="toc-connecting-to-the-container" class="nav-link" data-scroll-target="#connecting-to-the-container">Connecting to the container</a>
  <ul class="collapse">
  <li><a href="#running-rstudio" id="toc-running-rstudio" class="nav-link" data-scroll-target="#running-rstudio">Running RStudio</a></li>
  <li><a href="#connecting-to-the-sql-server-directly" id="toc-connecting-to-the-sql-server-directly" class="nav-link" data-scroll-target="#connecting-to-the-sql-server-directly">Connecting to the SQL server directly</a></li>
  <li><a href="#ssh" id="toc-ssh" class="nav-link" data-scroll-target="#ssh">SSH</a></li>
  <li><a href="#more-details" id="toc-more-details" class="nav-link" data-scroll-target="#more-details">More Details</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="sec-get-container" class="level1">
<h1>Downloading and Running NHANES Docker Container</h1>
<section id="downloading-the-container" class="level2">
<h2 data-anchor-id="downloading-the-container">Downloading the container</h2>
<section id="option-1-using-docker-desktop" class="level3">
<h3 data-anchor-id="option-1-using-docker-desktop">Option 1: Using Docker Desktop</h3>
<ol type="1">
<li>Make a free DockerHub account at <a href="https://hub.docker.com/">this link</a>.</li>
<li>Login to your DockerHub account in Docker Desktop:</li>
</ol>
<p><img src="../img/docker-signin.png" class="img-fluid" alt="Login within Docker Desktop"> 3. Search for <code>hmsccb/nhanes-workbench</code> in the search bar, to the left of where you previously clicked <code>Sign In</code> in the top blue bar. You should get one image as the result.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/docker-searchresult.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Search result</figcaption>
</figure>
</div>
<ol start="4" type="1">
<li>Make sure the <code>Tag</code> dropdown is set to <code>version-0.0.4</code> and click <code>Pull</code>.</li>
</ol>
</section>
<section id="option-2-using-the-command-line" class="level3">
<h3 data-anchor-id="option-2-using-the-command-line">Option 2: Using the command line</h3>
<p>Open a terminal (if in Mac or Linux) or the command prompt (in Windows). Type the command</p>
<pre><code>docker pull hmsccb/nhanes-workbench:version-0.0.4</code></pre>
<p>into the terminal.</p>
<p>You may need to specify a platform, you can try</p>
<pre><code>docker pull --platform linux/arm64 hmsccb/nhanes-workbench:version-0.0.4</code></pre>
<p>or</p>
<pre><code>docker pull --platform linux/x86_64/v8 hmsccb/nhanes-workbench:version-0.0.4</code></pre>
<p>if pulling without a platform is returning an error.</p>
<p>After you’ve downloaded the container, you should see it when you look at the <code>Images</code> tab in Docker Desktop.</p>
<p><img src="../img/docker-got-image.png" class="img-fluid" alt="Downloaded NHANES Image"> ## Setting up a volume</p>
</section>
</section>
<section id="running-the-container" class="level2">
<h2 data-anchor-id="running-the-container">Running the container</h2>
<p>Unfortunately, right now the container cannot be run from Docker Desktop due to Docker Desktop not allowing us to setup multiple ports. However, we can simply run the container from the command line.</p>
<p>On Mac or Linux, copy and paste the following command into a terminal:</p>
<pre><code>docker \
    run \
        --rm \
        --name nhanes-workbench \
        -d \
        -v LOCAL_DIRECTORY:/HostData \
        -p 8787:8787 \
        -p 2200:22 \
        -p 1433:1433 \
        -e 'CONTAINER_USER_USERNAME=USER' \
        -e 'CONTAINER_USER_PASSWORD=PASSWORD' \
        -e 'ACCEPT_EULA=Y' \
        -e 'SA_PASSWORD=yourStrong(!)Password' \
        hmsccb/nhanes-workbench:version-0.0.4</code></pre>
<p>Similar to pulling the container, if you get an error you may need to specify a platform by adding <code>--platform linux/arm64</code> or <code>--platform linux/x86_64/v8</code> to the run command.</p>
<p>If you’re using the WSL backend on Windows (recommended), you can open a linux terminal by hitting the windows key and typing in <code>WSL</code>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/run-wsl.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Running WSL</figcaption>
</figure>
</div>
<p>Paste the run command above into your terminal to run the container.</p>
<p>If you’re using the Hyper-V backend on Windows, copy and paste this command into the command prompt (this is the same as the Mac/Linux command but doesn’t use the <code>\</code> character to make it multiline):</p>
<pre><code>docker run  --rm --name nhanes-workbench -d  -v LOCAL_DIRECTORY:/HostData -p 8787:8787 -p 2200:22 -p 1433:1433  -e 'CONTAINER_USER_USERNAME=USER'  -e 'CONTAINER_USER_PASSWORD=PASSWORD' -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=yourStrong(!)Password' hmsccb/nhanes-workbench:version-0.0.4</code></pre>
<p>You can learn more about what each part of this command does below.</p>
<section id="details" class="level3">
<h3 data-anchor-id="details">Details</h3>
<section id="parameters" class="level4">
<h4 data-anchor-id="parameters">Parameters</h4>
<p><code>LOCAL_DIRECTORY</code> is a directory on the host that you would like mounted at /HostData in the container. Can be omitted.</p>
<p><code>CONTAINER_USER_USERNAME</code> is the name of the user in the container that will be created at runtime. You can connect via <code>ssh</code> or <code>RStudio Server</code> with this user name.</p>
<p><code>CONTAINER_USER_PASSWORD</code> is the password of the user in the container that will be created at runtime. You can connect via <code>ssh</code> or <code>RStudio Server</code> with this password.</p>
<p><code>ACCEPT_EULA</code> is required for SQL Server to successfully start</p>
<p><code>SA_PASSWORD</code> is the password for the SQL Server <code>sa</code> account. See <a href="https://docs.microsoft.com/en-us/sql/relational-databases/security/password-policy?view=sql-server-ver15">here</a> for complexity requirements.</p>
</section>
<section id="port-forwarding" class="level4">
<h4 data-anchor-id="port-forwarding">Port Forwarding</h4>
<p>These options control port forwarding from the container to the host:</p>
<pre><code>        -p 8787:8787 \
        -p 2200:22 \
        -p 1433:1433 \</code></pre>
<p>Port 8787 is used for access to the RStudio Server HTTP server. Port 2200 on the host provides access to ssh server in the container. Port 1433 provides access to SQL Server running in the container.</p>
</section>
</section>
<section id="confirming-that-the-container-is-running" class="level3">
<h3 data-anchor-id="confirming-that-the-container-is-running">Confirming that the container is running</h3>
<p>Inside Docker Desktop, in the <code>Containers</code> tab you should now see the <code>nhanes-workbench</code> container.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/docker-running.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The running container</figcaption>
</figure>
</div>
</section>
<section id="inspecting-the-container" class="level3">
<h3 data-anchor-id="inspecting-the-container">Inspecting the container</h3>
<p>If you click on the <code>nhanes-workbench</code> entry, you can see and interact with the running container in a number of tabs.</p>
<p><strong>Logs</strong></p>
<p>This tab shows all of the output of the running container. If you are having problems with the container, the logs are the place to try to figure out what is going wrong.</p>
<p><strong>Inspect</strong></p>
<p>This tab gives you the general container information. You can check here to see where mounted files in the container live under <code>Mounts</code> or double check what you set your password to under <code>Environment</code>.</p>
<p><strong>Terminal</strong></p>
<p>This tab gives you a command-line interface into the container while it is running. Here you can manipulate files, run command-line tools, or anything else you’d need to do at the terminal inside the container.</p>
<p><strong>Files</strong></p>
<p>This tab lets you easily explore all of the files in the container.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/docker-files.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Inspecting the container’s files</figcaption>
</figure>
</div>
<p>You can select files or folders by right/command clicking on them, then select <code>Save</code> to save a copy of that file somewhere on your computer outside of the container.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/docker-save.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Saving a file to outside docker</figcaption>
</figure>
</div>
</section>
</section>
<section id="connecting-to-the-container" class="level2">
<h2 data-anchor-id="connecting-to-the-container">Connecting to the container</h2>
<section id="running-rstudio" class="level3">
<h3 data-anchor-id="running-rstudio">Running RStudio</h3>
<p>Once the Docker container is running, you can connect to it by pointing your web browser to port 8787. To do this, simply type <code>http://localhost:8787</code> into your browser’s address bar. You’ll then need to login using <code>USER</code> and <code>PASSWORD</code> or whatever you set <code>CONTAINER_USER_USERNAME</code> and <code>CONTAINER_USER_PASSWORD</code> to when creating the container. You will then be in an RStudio instance inside the container.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/docker-rstudio-running.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Running RStudio in your browser</figcaption>
</figure>
</div>
</section>
<section id="connecting-to-the-sql-server-directly" class="level3">
<h3 data-anchor-id="connecting-to-the-sql-server-directly">Connecting to the SQL server directly</h3>
<p>Database connectivity is enabled on TCP port 1433 on the host. Any standard tools that work with SQL Server (Azure Data Studio, SSMS, ODBC, JDBC) can be aimed at this port on the host to work with the DBs in the container.</p>
<p>If you are already familiar with relational databases, this can be a great option for accessing the NHANES data.</p>
<p>For instance, in Azure Data Studio you can connect to <code>localhost</code> using the username <code>SA</code> and password <code>yourStrong(!)Password</code> or whatever <code>SA_PASSWORD</code> was set to when you created the container. Note that you’ll have to set the authentication to <code>SQL Login</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/azure-connect.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Connecting to the SQL server</figcaption>
</figure>
</div>
</section>
<section id="ssh" class="level3">
<h3 data-anchor-id="ssh">SSH</h3>
<p>You can can ssh into the container, e.g.:</p>
<pre><code>ssh USER@HOST_ADDRESS -p 2200 -o GlobalKnownHostsFile=/dev/null -o UserKnownHostsFile=/dev/null</code></pre>
<p>If you are running SSH on the same host where the container is running:</p>
<pre><code>ssh USER@localhost -p 2200 -o GlobalKnownHostsFile=/dev/null -o UserKnownHostsFile=/dev/null</code></pre>
</section>
<section id="more-details" class="level3">
<h3 data-anchor-id="more-details">More Details</h3>
<p>You can find more details and some example scripts for running the SQL server on its <a href="https://github.com/ccb-hms/NHANES">Github page</a>.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>