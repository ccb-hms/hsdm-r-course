<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Research Design and Analysis – ggplot-basics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar docked nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Research Design and Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../readings/readings.html" rel="" target="" aria-current="page">
 <span class="menu-text">Readings</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../session-materials/sessions.html" rel="" target="">
 <span class="menu-text">In-Class Materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources/resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../readings/ggplot-basics.html">Week 2</a></li><li class="breadcrumb-item"><a href="../readings/ggplot-basics.html">Data visualization</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings/readings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Week 0</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings/install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installing R and RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings/rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings/basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Basics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Week 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings/data-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Data Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings/using-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Data Operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings/recoding-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recoding Values</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Week 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings/ggplot-basics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Data visualization</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Week 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../readings/manage-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Managing Data</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link active" data-scroll-target="#data-visualization">Data visualization</a>
  <ul class="collapse">
  <li><a href="#basics-of-ggplot" id="toc-basics-of-ggplot" class="nav-link" data-scroll-target="#basics-of-ggplot">Basics of ggplot</a></li>
  <li><a href="#ggplot" id="toc-ggplot" class="nav-link" data-scroll-target="#ggplot"><code>ggplot()</code></a></li>
  <li><a href="#geoms" id="toc-geoms" class="nav-link" data-scroll-target="#geoms">Geoms</a></li>
  <li><a href="#ggplot_basics_mapping" id="toc-ggplot_basics_mapping" class="nav-link" data-scroll-target="#ggplot_basics_mapping">Mapping data to the plot</a>
  <ul class="collapse">
  <li><a href="#plot-aesthetics" id="toc-plot-aesthetics" class="nav-link" data-scroll-target="#plot-aesthetics">Plot aesthetics</a></li>
  <li><a href="#set-to-a-static-value" id="toc-set-to-a-static-value" class="nav-link" data-scroll-target="#set-to-a-static-value">Set to a static value</a></li>
  <li><a href="#scaled-to-column-values" id="toc-scaled-to-column-values" class="nav-link" data-scroll-target="#scaled-to-column-values">Scaled to column values</a></li>
  <li><a href="#ggplot_basics_map_loc" id="toc-ggplot_basics_map_loc" class="nav-link" data-scroll-target="#ggplot_basics_map_loc">Where to make mapping assignments</a></li>
  <li><a href="#ggplotgroups" id="toc-ggplotgroups" class="nav-link" data-scroll-target="#ggplotgroups">Groups</a></li>
  </ul></li>
  <li><a href="#ggplot_basics_facet" id="toc-ggplot_basics_facet" class="nav-link" data-scroll-target="#ggplot_basics_facet">Facets / Small-multiples</a>
  <ul class="collapse">
  <li><a href="#facet_wrap" id="toc-facet_wrap" class="nav-link" data-scroll-target="#facet_wrap"><code>facet_wrap()</code></a></li>
  <li><a href="#facet_grid" id="toc-facet_grid" class="nav-link" data-scroll-target="#facet_grid"><code>facet_grid()</code></a></li>
  <li><a href="#free-or-fixed-axes" id="toc-free-or-fixed-axes" class="nav-link" data-scroll-target="#free-or-fixed-axes">Free or fixed axes</a></li>
  </ul></li>
  <li><a href="#exporting-plots" id="toc-exporting-plots" class="nav-link" data-scroll-target="#exporting-plots">Exporting plots</a></li>
  <li><a href="#labels" id="toc-labels" class="nav-link" data-scroll-target="#labels">Labels</a></li>
  <li><a href="#plot-continuous-data" id="toc-plot-continuous-data" class="nav-link" data-scroll-target="#plot-continuous-data">Plot continuous data</a>
  <ul class="collapse">
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms">Histograms</a></li>
  <li><a href="#box-plots" id="toc-box-plots" class="nav-link" data-scroll-target="#box-plots">Box plots</a></li>
  <li><a href="#violin-jitter-and-sina-plots" id="toc-violin-jitter-and-sina-plots" class="nav-link" data-scroll-target="#violin-jitter-and-sina-plots">Violin, jitter, and sina plots</a></li>
  <li><a href="#two-continuous-variables" id="toc-two-continuous-variables" class="nav-link" data-scroll-target="#two-continuous-variables">Two continuous variables</a></li>
  <li><a href="#three-continuous-variables" id="toc-three-continuous-variables" class="nav-link" data-scroll-target="#three-continuous-variables">Three continuous variables</a></li>
  </ul></li>
  <li><a href="#plot-categorical-data" id="toc-plot-categorical-data" class="nav-link" data-scroll-target="#plot-categorical-data">Plot categorical data</a>
  <ul class="collapse">
  <li><a href="#preparation" id="toc-preparation" class="nav-link" data-scroll-target="#preparation">Preparation</a></li>
  <li><a href="#ggplot_basics_bars" id="toc-ggplot_basics_bars" class="nav-link" data-scroll-target="#ggplot_basics_bars"><code>geom_bar()</code></a></li>
  <li><a href="#geom_col" id="toc-geom_col" class="nav-link" data-scroll-target="#geom_col"><code>geom_col()</code></a></li>
  </ul></li>
  <li><a href="#ggplot_basics_themes" id="toc-ggplot_basics_themes" class="nav-link" data-scroll-target="#ggplot_basics_themes">Themes</a>
  <ul class="collapse">
  <li><a href="#complete-themes" id="toc-complete-themes" class="nav-link" data-scroll-target="#complete-themes">Complete themes</a></li>
  <li><a href="#modify-theme" id="toc-modify-theme" class="nav-link" data-scroll-target="#modify-theme">Modify theme</a></li>
  </ul></li>
  <li><a href="#ggplot_tips_colors" id="toc-ggplot_tips_colors" class="nav-link" data-scroll-target="#ggplot_tips_colors">Scales for color, fill, axes, etc.</a>
  <ul class="collapse">
  <li><a href="#color-schemes" id="toc-color-schemes" class="nav-link" data-scroll-target="#color-schemes">Color schemes</a></li>
  <li><a href="#ggplot_tips_scales" id="toc-ggplot_tips_scales" class="nav-link" data-scroll-target="#ggplot_tips_scales">Scales</a></li>
  <li><a href="#scale-arguments" id="toc-scale-arguments" class="nav-link" data-scroll-target="#scale-arguments">Scale arguments</a></li>
  <li><a href="#manual-adjustments" id="toc-manual-adjustments" class="nav-link" data-scroll-target="#manual-adjustments">Manual adjustments</a></li>
  <li><a href="#continuous-axes-scales" id="toc-continuous-axes-scales" class="nav-link" data-scroll-target="#continuous-axes-scales">Continuous axes scales</a></li>
  <li><a href="#gradient-scales" id="toc-gradient-scales" class="nav-link" data-scroll-target="#gradient-scales">Gradient scales</a></li>
  <li><a href="#palettes" id="toc-palettes" class="nav-link" data-scroll-target="#palettes">Palettes</a></li>
  </ul></li>
  <li><a href="#change-order-of-discrete-variables" id="toc-change-order-of-discrete-variables" class="nav-link" data-scroll-target="#change-order-of-discrete-variables">Change order of discrete variables</a></li>
  <li><a href="#advanced-ggplot-optional" id="toc-advanced-ggplot-optional" class="nav-link" data-scroll-target="#advanced-ggplot-optional">Advanced ggplot (optional)</a>
  <ul class="collapse">
  <li><a href="#contour-lines" id="toc-contour-lines" class="nav-link" data-scroll-target="#contour-lines">Contour lines</a></li>
  <li><a href="#marginal-distributions" id="toc-marginal-distributions" class="nav-link" data-scroll-target="#marginal-distributions">Marginal distributions</a></li>
  <li><a href="#smart-labeling" id="toc-smart-labeling" class="nav-link" data-scroll-target="#smart-labeling">Smart Labeling</a></li>
  <li><a href="#highlighting" id="toc-highlighting" class="nav-link" data-scroll-target="#highlighting">Highlighting</a></li>
  <li><a href="#plotting-multiple-datasets" id="toc-plotting-multiple-datasets" class="nav-link" data-scroll-target="#plotting-multiple-datasets">Plotting multiple datasets</a></li>
  <li><a href="#combine-plots" id="toc-combine-plots" class="nav-link" data-scroll-target="#combine-plots">Combine plots</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="ggplot-basics.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="data-visualization" class="level1">
<h1>Data visualization</h1>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Extended Materials
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can find the original, extended version of these materials from chapters <a href="https://epirhandbook.com/en/ggplot-basics.html">30</a> and <a href="https://epirhandbook.com/en/ggplot-tips.html">31</a>.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/ggplot_basics_top.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>ggplot2</strong> is the most popular data visualisation R package. Its <code>ggplot()</code> function is at the core of this package, and this whole approach is colloquially known as <em>“ggplot”</em> with the resulting figures sometimes affectionately called “ggplots”. The “gg” in these names reflects the “<strong>g</strong>rammar of <strong>g</strong>raphics” used to construct the figures. <strong>ggplot2</strong> benefits from a wide variety of supplementary R packages that further enhance its functionality.</p>
<p>The <a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf">data visualization with ggplot cheatsheet</a> from the RStudio website is a great reference to have on-hand when creating pltos. If you want inspiration for ways to creatively visualise your data, we suggest reviewing websites like the <a href="https://www.r-graph-gallery.com/">R graph gallery</a> and <a href="https://www.data-to-viz.com/caveats.html">Data-to-viz</a>.</p>
<!-- ======================================================= -->
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data Preparation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<section id="import-data" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="import-data">Import data</h3>
<p>We import the dataset of cases from a simulated Ebola epidemic. If you want to follow along, <a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">click to download the “clean” linelist</a> (as .rds file).</p>
<p>The first 50 rows of the linelist are displayed below. We will focus on the continuous variables <code>age</code>, <code>wt_kg</code> (weight in kilos), <code>ct_blood</code> (CT values), and <code>days_onset_hosp</code> (difference between onset date and hospitalisation).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   case_id generation date_infection date_onset date_hospitalisation
1   5fe599          4     2014-05-08 2014-05-13           2014-05-15
2   8689b7          4           &lt;NA&gt; 2014-05-13           2014-05-14
3   11f8ea          2           &lt;NA&gt; 2014-05-16           2014-05-18
4   b8812a          3     2014-05-04 2014-05-18           2014-05-20
5   893f25          3     2014-05-18 2014-05-21           2014-05-22
6   be99c8          3     2014-05-03 2014-05-22           2014-05-23
7   07e3e8          4     2014-05-22 2014-05-27           2014-05-29
8   369449          4     2014-05-28 2014-06-02           2014-06-03
9   f393b4          4           &lt;NA&gt; 2014-06-05           2014-06-06
10  1389ca          4           &lt;NA&gt; 2014-06-05           2014-06-07
11  2978ac          4     2014-05-30 2014-06-06           2014-06-08
12  57a565          4     2014-05-28 2014-06-13           2014-06-15
13  fc15ef          6     2014-06-14 2014-06-16           2014-06-17
14  2eaa9a          5     2014-06-07 2014-06-17           2014-06-17
15  bbfa93          6     2014-06-09 2014-06-18           2014-06-20
16  c97dd9          9           &lt;NA&gt; 2014-06-19           2014-06-19
17  f50e8a         10           &lt;NA&gt; 2014-06-22           2014-06-23
18  3a7673          8           &lt;NA&gt; 2014-06-23           2014-06-24
19  7f5a01          7     2014-06-23 2014-06-25           2014-06-27
20  ddddee          6     2014-06-18 2014-06-26           2014-06-28
21  99e8fa          7     2014-06-24 2014-06-28           2014-06-29
22  567136          6           &lt;NA&gt; 2014-07-02           2014-07-03
23  9371a9          8           &lt;NA&gt; 2014-07-08           2014-07-09
24  bc2adf          6     2014-07-03 2014-07-09           2014-07-09
25  403057         10           &lt;NA&gt; 2014-07-09           2014-07-11
26  8bd1e8          8     2014-07-10 2014-07-10           2014-07-11
27  f327be          6     2014-06-14 2014-07-12           2014-07-13
28  42e1a9         12           &lt;NA&gt; 2014-07-12           2014-07-14
29  90e5fe          5     2014-06-18 2014-07-13           2014-07-14
30  959170          8     2014-06-29 2014-07-13           2014-07-13
31  8ebf6e          7     2014-07-02 2014-07-14           2014-07-14
32  e56412          9     2014-07-12 2014-07-15           2014-07-17
33  6d788e         11     2014-07-12 2014-07-16           2014-07-17
34  a47529          5     2014-06-13 2014-07-17           2014-07-18
35  67be4e          8     2014-07-15 2014-07-17           2014-07-19
36  da8ecb          5     2014-06-20 2014-07-18           2014-07-20
37  148f18          6           &lt;NA&gt; 2014-07-19           2014-07-20
38  2cb9a5         11           &lt;NA&gt; 2014-07-22           2014-07-22
39  f5c142          7     2014-07-20 2014-07-22           2014-07-24
40  70a9fe          9           &lt;NA&gt; 2014-07-24           2014-07-26
41  3ad520          7     2014-07-12 2014-07-24           2014-07-24
42  062638          8     2014-07-19 2014-07-25           2014-07-27
43  c76676          9     2014-07-18 2014-07-25           2014-07-25
44  baacc1         12     2014-07-18 2014-07-27           2014-07-27
45  497372         13     2014-07-27 2014-07-29           2014-07-31
46  23e499          9           &lt;NA&gt; 2014-07-30           2014-08-01
47  38cc4a          8     2014-07-19       &lt;NA&gt;           2014-08-03
48  3789ee         10     2014-07-26 2014-08-01           2014-08-02
49  c71dcd          8     2014-07-24 2014-08-02           2014-08-02
50  6b70f0          7           &lt;NA&gt; 2014-08-03           2014-08-04
   date_outcome outcome gender age age_unit age_years age_cat age_cat5
1          &lt;NA&gt;    &lt;NA&gt;      m   2    years         2     0-4      0-4
2    2014-05-18 Recover      f   3    years         3     0-4      0-4
3    2014-05-30 Recover      m  56    years        56   50-69    55-59
4          &lt;NA&gt;    &lt;NA&gt;      f  18    years        18   15-19    15-19
5    2014-05-29 Recover      m   3    years         3     0-4      0-4
6    2014-05-24 Recover      f  16    years        16   15-19    15-19
7    2014-06-01 Recover      f  16    years        16   15-19    15-19
8    2014-06-07   Death      f   0    years         0     0-4      0-4
9    2014-06-18 Recover      m  61    years        61   50-69    60-64
10   2014-06-09   Death      f  27    years        27   20-29    25-29
11   2014-06-15   Death      m  12    years        12   10-14    10-14
12         &lt;NA&gt;   Death      m  42    years        42   30-49    40-44
13   2014-07-09 Recover      m  19    years        19   15-19    15-19
14         &lt;NA&gt; Recover      f   7    years         7     5-9      5-9
15   2014-06-30    &lt;NA&gt;      f   7    years         7     5-9      5-9
16   2014-07-11 Recover      m  13    years        13   10-14    10-14
17   2014-07-01    &lt;NA&gt;      f  35    years        35   30-49    35-39
18   2014-06-25    &lt;NA&gt;      f  17    years        17   15-19    15-19
19   2014-07-06   Death      f  11    years        11   10-14    10-14
20   2014-07-02   Death      f  11    years        11   10-14    10-14
21   2014-07-09 Recover      m  19    years        19   15-19    15-19
22   2014-07-07    &lt;NA&gt;      m  54    years        54   50-69    50-54
23   2014-07-20    &lt;NA&gt;      f  14    years        14   10-14    10-14
24         &lt;NA&gt;    &lt;NA&gt;      m  28    years        28   20-29    25-29
25   2014-07-22   Death      f   6    years         6     5-9      5-9
26   2014-07-16    &lt;NA&gt;      m   3    years         3     0-4      0-4
27   2014-07-14   Death      m  31    years        31   30-49    30-34
28   2014-07-20   Death      f   6    years         6     5-9      5-9
29   2014-07-16    &lt;NA&gt;      m  67    years        67   50-69    65-69
30   2014-07-19   Death      f  14    years        14   10-14    10-14
31   2014-07-27 Recover      f  10    years        10   10-14    10-14
32   2014-07-19   Death      f  21    years        21   20-29    20-24
33         &lt;NA&gt; Recover      m  20    years        20   20-29    20-24
34   2014-07-26   Death      m  45    years        45   30-49    45-49
35   2014-08-14 Recover      f   1    years         1     0-4      0-4
36   2014-08-01    &lt;NA&gt;      m  12    years        12   10-14    10-14
37   2014-07-23   Death      f   3    years         3     0-4      0-4
38   2014-08-28 Recover      f  15    years        15   15-19    15-19
39   2014-07-28 Recover      f  20    years        20   20-29    20-24
40   2014-07-19   Death      m  36    years        36   30-49    35-39
41         &lt;NA&gt;    &lt;NA&gt;      f   7    years         7     5-9      5-9
42   2014-08-03    &lt;NA&gt;      m  13    years        13   10-14    10-14
43         &lt;NA&gt;   Death      f  14    years        14   10-14    10-14
44         &lt;NA&gt;   Death      m   3    years         3     0-4      0-4
45         &lt;NA&gt;   Death      m  10    years        10   10-14    10-14
46   2014-08-06   Death      f   1    years         1     0-4      0-4
47   2014-08-21 Recover      m   0    years         0     0-4      0-4
48   2014-09-13    &lt;NA&gt;      f  20    years        20   20-29    20-24
49   2014-08-04   Death      m  26    years        26   20-29    25-29
50         &lt;NA&gt;   Death      m  14    years        14   10-14    10-14
                               hospital       lon      lat infector  source
1                                 Other -13.21574 8.468973   f547d6   other
2                               Missing -13.21523 8.451719     &lt;NA&gt;    &lt;NA&gt;
3  St. Mark's Maternity Hospital (SMMH) -13.21291 8.464817     &lt;NA&gt;    &lt;NA&gt;
4                         Port Hospital -13.23637 8.475476   f90f5f   other
5                     Military Hospital -13.22286 8.460824   11f8ea   other
6                         Port Hospital -13.22263 8.461831   aec8ec   other
7                               Missing -13.23315 8.462729   893f25   other
8                               Missing -13.23210 8.461444   133ee7   other
9                               Missing -13.22255 8.461913     &lt;NA&gt;    &lt;NA&gt;
10                              Missing -13.25722 8.472923     &lt;NA&gt;    &lt;NA&gt;
11                        Port Hospital -13.22063 8.484016   996f3a   other
12                    Military Hospital -13.25399 8.458371   133ee7   other
13                              Missing -13.23851 8.477617   37a6f6   other
14                              Missing -13.20939 8.475702   9f6884   other
15                                Other -13.21573 8.477799   4802b1   other
16                        Port Hospital -13.22434 8.471451     &lt;NA&gt;    &lt;NA&gt;
17                        Port Hospital -13.23361 8.478048     &lt;NA&gt;    &lt;NA&gt;
18                        Port Hospital -13.21422 8.485280     &lt;NA&gt;    &lt;NA&gt;
19                              Missing -13.23397 8.469575   a75c7f   other
20                                Other -13.25356 8.459574   8e104d   other
21                        Port Hospital -13.22501 8.474049   ab634e   other
22                        Port Hospital -13.21607 8.488029     &lt;NA&gt;    &lt;NA&gt;
23 St. Mark's Maternity Hospital (SMMH) -13.26807 8.473437     &lt;NA&gt;    &lt;NA&gt;
24                              Missing -13.22667 8.484083   b799eb   other
25                                Other -13.21602 8.462422     &lt;NA&gt;    &lt;NA&gt;
26                              Missing -13.24826 8.470268   5d9e4d   other
27 St. Mark's Maternity Hospital (SMMH) -13.21563 8.463984   a15e13   other
28                    Military Hospital -13.21424 8.464135     &lt;NA&gt;    &lt;NA&gt;
29                        Port Hospital -13.26149 8.456231   ea3740   other
30                     Central Hospital -13.24530 8.483346   beb26e funeral
31                    Military Hospital -13.26306 8.474940   567136   other
32                     Central Hospital -13.23433 8.478321   894024 funeral
33                              Missing -13.21991 8.469393   36e2e7   other
34                    Military Hospital -13.22273 8.484806   a2086d   other
35                                Other -13.23431 8.471212   7baf73   other
36                              Missing -13.21878 8.484384   eb2277 funeral
37                              Missing -13.24837 8.484662     &lt;NA&gt;    &lt;NA&gt;
38                        Port Hospital -13.20975 8.477142     &lt;NA&gt;    &lt;NA&gt;
39                        Port Hospital -13.26809 8.462381   d6584f   other
40                        Port Hospital -13.25875 8.455686     &lt;NA&gt;    &lt;NA&gt;
41                              Missing -13.26264 8.463288   312ecf   other
42                     Central Hospital -13.26972 8.479407   52ea64   other
43                    Military Hospital -13.22090 8.463539   cfd79c   other
44                                Other -13.23307 8.461790   d145b7   other
45                                Other -13.26809 8.475087   174288   other
46                                Other -13.25472 8.458258     &lt;NA&gt;    &lt;NA&gt;
47                              Missing -13.25737 8.453257   53608c funeral
48 St. Mark's Maternity Hospital (SMMH) -13.21374 8.473257   3b096b   other
49 St. Mark's Maternity Hospital (SMMH) -13.21760 8.479116   f5c142   other
50                              Missing -13.24864 8.484803     &lt;NA&gt;    &lt;NA&gt;
   wt_kg ht_cm ct_blood fever chills cough aches vomit temp time_admission
1     27    48       22    no     no   yes    no   yes 36.8           &lt;NA&gt;
2     25    59       22  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 36.9          09:36
3     91   238       21  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 36.9          16:48
4     41   135       23    no     no    no    no    no 36.8          11:22
5     36    71       23    no     no   yes    no   yes 36.9          12:60
6     56   116       21    no     no   yes    no   yes 37.6          14:13
7     47    87       21  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 37.3          14:33
8      0    11       22    no     no   yes    no   yes 37.0          09:25
9     86   226       22    no     no   yes    no   yes 36.4          11:16
10    69   174       22    no     no   yes    no    no 35.9          10:55
11    67   112       22    no     no   yes    no   yes 36.5          16:03
12    84   186       22    no     no   yes    no    no 36.9          11:14
13    68   174       22    no     no   yes    no    no 36.5          12:42
14    44    90       21    no     no   yes    no    no 37.1          11:06
15    34    91       23    no     no   yes    no   yes 36.5          09:10
16    66   152       22    no     no   yes   yes    no 37.3          08:45
17    78   214       23    no    yes   yes    no    no 37.0           &lt;NA&gt;
18    47   137       21    no     no   yes    no    no 38.0          15:41
19    53   117       22  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 38.0          13:34
20    47   131       23    no     no   yes    no    no 36.0          18:58
21    71   150       21    no     no   yes    no   yes 37.0          12:43
22    86   241       23    no     no   yes    no    no 36.7          16:33
23    53   131       21    no    yes   yes    no    no 36.9          14:29
24    69   161       24    no     no   yes    no    no 36.5          07:18
25    38    80       23  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 37.0          08:11
26    46    69       22    no     no   yes    no    no 36.5          16:32
27    68   188       24    no     no   yes    no    no 37.6          16:17
28    37    66       23    no    yes   yes    no    no 36.6          07:32
29   100   233       20  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 36.6          17:45
30    56   142       24  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 36.2           &lt;NA&gt;
31    50   110       24    no     no   yes    no    no 36.4          13:24
32    57   182       20    no     no   yes    no   yes 37.1          14:43
33    65   164       24  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 37.5          02:33
34    72   214       21    no     no   yes    no   yes 37.5          11:36
35    29    26       22    no     no   yes    no   yes 37.4          17:28
36    69   157       21  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 36.9          16:27
37    37    39       23  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 36.4           &lt;NA&gt;
38    48   154       22    no     no   yes   yes   yes 37.3          20:49
39    54   133       23    no     no   yes   yes   yes 37.0           &lt;NA&gt;
40    71   168       23  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 37.8          11:38
41    47   100       23    no     no   yes    no   yes 36.5          14:25
42    61   125       22    no     no   yes    no   yes 37.5          13:42
43    47   123       23  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 36.7          21:22
44    35    67       22    no     no   yes    no   yes 37.0          13:33
45    53   134       22    no    yes   yes    no   yes 37.3          19:06
46    16    31       22    no     no   yes    no    no 36.6          17:14
47    13    36       23    no     no   yes    no   yes 36.5          20:09
48    59   125       22    no     no   yes    no   yes 36.6           &lt;NA&gt;
49    69   183       22    no     no    no    no   yes 37.6          10:23
50    67   169       22  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 36.8          09:09
         bmi days_onset_hosp
1  117.18750               2
2   71.81844               1
3   16.06525               2
4   22.49657               2
5   71.41440               1
6   41.61712               1
7   62.09539               2
8    0.00000               1
9   16.83765               1
10  22.79033               2
11  53.41199               2
12  24.28026               2
13  22.46003               1
14  54.32099               0
15  41.05784               2
16  28.56648               0
17  17.03206               1
18  25.04129               1
19  38.71722               2
20  27.38768               2
21  31.55556               1
22  14.80691               1
23  30.88398               1
24  26.61934               0
25  59.37500               2
26  96.61836               1
27  19.23947               1
28  84.94031               2
29  18.41994               1
30  27.77227               0
31  41.32231               0
32  17.20807               2
33  24.16716               1
34  15.72190               1
35 428.99408               2
36  27.99302               2
37 243.26101               1
38  20.23950               0
39  30.52745               2
40  25.15590               2
41  47.00000               0
42  39.04000               2
43  31.06616               0
44  77.96837               0
45  29.51660               2
46 166.49324               2
47 100.30864              NA
48  37.76000               1
49  20.60378               0
50  23.45856               1</code></pre>
</div>
</div>
</section>
<section id="general-cleaning" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="general-cleaning">General cleaning</h3>
<p>Some simple ways we can prepare our data to make it better for plotting can include making the contents of the data better for display - which does not necessarily equate to better for data manipulation. For example:</p>
<ul>
<li>Replace <code>NA</code> values in a character column with the character string “Unknown”<br>
</li>
<li>Consider converting column to class <em>factor</em> so their values have prescribed ordinal levels<br>
</li>
<li>Clean some columns so that their “data friendly” values with underscores etc are changed to normal text or title case.</li>
</ul>
<p>Here are some examples of this in action:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make display version of columns with more friendly names</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender_disp =</span> <span class="fu">case_when</span>(gender <span class="sc">==</span> <span class="st">"m"</span> <span class="sc">~</span> <span class="st">"Male"</span>,        <span class="co"># m to Male </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                            gender <span class="sc">==</span> <span class="st">"f"</span> <span class="sc">~</span> <span class="st">"Female"</span>,      <span class="co"># f to Female,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">is.na</span>(gender) <span class="sc">~</span> <span class="st">"Unknown"</span>),    <span class="co"># NA to Unknown</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_disp =</span> <span class="fu">replace_na</span>(outcome, <span class="st">"Unknown"</span>)          <span class="co"># replace NA outcome with "unknown"</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pivoting-longer" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="pivoting-longer">Pivoting longer</h3>
<p>As a matter of data structure, for <strong>ggplot2</strong> we often also want to pivot our data into <em>longer</em> formats. We will learn more about pivoting later; for now it’s enough to be aware that these two data formats exist.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/pivot_longer_new.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>For example, say that we want to plot data that are in a “wide” format, such as for each case in the <code>linelist</code> and their symptoms. Below we create a mini-linelist called <code>symptoms_data</code> that contains only the <code>case_id</code> and symptoms columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>symptoms_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(case_id, fever, chills, cough, aches, vomit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is how the first 50 rows of this mini-linelist look - see how they are formatted “wide” with each symptom as a column:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   case_id fever chills cough aches vomit
1   5fe599    no     no   yes    no   yes
2   8689b7  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
3   11f8ea  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
4   b8812a    no     no    no    no    no
5   893f25    no     no   yes    no   yes
6   be99c8    no     no   yes    no   yes
7   07e3e8  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
8   369449    no     no   yes    no   yes
9   f393b4    no     no   yes    no   yes
10  1389ca    no     no   yes    no    no
11  2978ac    no     no   yes    no   yes
12  57a565    no     no   yes    no    no
13  fc15ef    no     no   yes    no    no
14  2eaa9a    no     no   yes    no    no
15  bbfa93    no     no   yes    no   yes
16  c97dd9    no     no   yes   yes    no
17  f50e8a    no    yes   yes    no    no
18  3a7673    no     no   yes    no    no
19  7f5a01  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
20  ddddee    no     no   yes    no    no
21  99e8fa    no     no   yes    no   yes
22  567136    no     no   yes    no    no
23  9371a9    no    yes   yes    no    no
24  bc2adf    no     no   yes    no    no
25  403057  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
26  8bd1e8    no     no   yes    no    no
27  f327be    no     no   yes    no    no
28  42e1a9    no    yes   yes    no    no
29  90e5fe  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
30  959170  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
31  8ebf6e    no     no   yes    no    no
32  e56412    no     no   yes    no   yes
33  6d788e  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
34  a47529    no     no   yes    no   yes
35  67be4e    no     no   yes    no   yes
36  da8ecb  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
37  148f18  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
38  2cb9a5    no     no   yes   yes   yes
39  f5c142    no     no   yes   yes   yes
40  70a9fe  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
41  3ad520    no     no   yes    no   yes
42  062638    no     no   yes    no   yes
43  c76676  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
44  baacc1    no     no   yes    no   yes
45  497372    no    yes   yes    no   yes
46  23e499    no     no   yes    no    no
47  38cc4a    no     no   yes    no   yes
48  3789ee    no     no   yes    no   yes
49  c71dcd    no     no    no    no   yes
50  6b70f0  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;</code></pre>
</div>
</div>
<p>If we wanted to plot the number of cases with specific symptoms, we are limited by the fact that each symptom is a specific column. However, we can <em>pivot</em> the symptoms columns to a longer format like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>symptoms_data_long <span class="ot">&lt;-</span> symptoms_data <span class="sc">%&gt;%</span>    <span class="co"># begin with "mini" linelist called symptoms_data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>case_id,                       <span class="co"># pivot all columns except case_id (all the symptoms columns)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"symptom_name"</span>,             <span class="co"># assign name for new column that holds the symptoms</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"symptom_is_present"</span>) <span class="sc">%&gt;%</span>  <span class="co"># assign name for new column that holds the values (yes/no)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">symptom_is_present =</span> <span class="fu">replace_na</span>(symptom_is_present, <span class="st">"unknown"</span>)) <span class="co"># convert NA to "unknown"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are the first 50 rows. Note that case has 5 rows - one for each possible symptom. The new columns <code>symptom_name</code> and <code>symptom_is_present</code> are the result of the pivot. Note that this format may not be very useful for other operations, but is useful for plotting.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 3
   case_id symptom_name symptom_is_present
   &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;             
 1 5fe599  fever        no                
 2 5fe599  chills       no                
 3 5fe599  cough        yes               
 4 5fe599  aches        no                
 5 5fe599  vomit        yes               
 6 8689b7  fever        unknown           
 7 8689b7  chills       unknown           
 8 8689b7  cough        unknown           
 9 8689b7  aches        unknown           
10 8689b7  vomit        unknown           
# ℹ 40 more rows</code></pre>
</div>
</div>
<!-- ======================================================= -->
</section>
</div>
</div>
</div>
<section id="basics-of-ggplot" class="level2">
<h2 class="anchored" data-anchor-id="basics-of-ggplot">Basics of ggplot</h2>
<p><strong>“Grammar of graphics” - ggplot2</strong></p>
<p>Plotting with <strong>ggplot2</strong> is based on “adding” plot layers and design elements on top of one another, with each command added to the previous ones with a plus symbol (<code>+</code>). The result is a multi-layer plot object that can be saved, modified, printed, exported, etc.</p>
<blockquote class="blockquote">
<p>The idea behind the Grammar of Graphics it is that you can build every graph from the same 3 components: (1) a data set, (2) a coordinate system, and (3) geoms — i.e.&nbsp;visual marks that represent data points [<a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-visualization.pdf">source</a>]</p>
</blockquote>
<p>ggplot objects can be highly complex, but the basic order of layers will usually look like this:</p>
<ol type="1">
<li>Begin with the baseline <code>ggplot()</code> command - this “opens” the ggplot and allow subsequent functions to be added with <code>+</code>. Typically the dataset is also specified in this command<br>
</li>
<li>Add “geom” layers - these functions visualize the data as <em>geometries</em> (<em>shapes</em>), e.g.&nbsp;as a bar graph, line plot, scatter plot, histogram (or a combination!). These functions all start with <code>geom_</code> as a prefix.<br>
</li>
<li>Add design elements to the plot such as axis labels, title, fonts, sizes, color schemes, legends, or axes rotation</li>
</ol>
<p>In code this amounts to the basic template:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATA<span class="sc">&gt;</span>, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPPINGS<span class="sc">&gt;</span>)) <span class="sc">+</span>  <span class="er">&lt;</span>GEOM_FUNCTION<span class="sc">&gt;</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can further expand this template to include aspects of the visualization such as theme and labels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data from my_data columns as red points</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> my_data)<span class="sc">+</span>                   <span class="co"># use the dataset "my_data"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(                             <span class="co"># add a layer of points (dots)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> col1, <span class="at">y =</span> col2),    <span class="co"># "map" data column to axes</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span>                       <span class="co"># other specification for the geom</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>()<span class="sc">+</span>                                 <span class="co"># here you add titles, axes labels, etc.</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()                                 <span class="co"># here you adjust color, font, size etc of non-data plot elements (axes, title, etc.) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will explain each component in the sections below.</p>
</section>
<section id="ggplot" class="level2">
<h2 class="anchored" data-anchor-id="ggplot"><code>ggplot()</code></h2>
<p>The opening command of any ggplot2 plot is <code>ggplot()</code>. This command simply creates a blank canvas upon which to add layers. It “opens” the way for further layers to be added with a <code>+</code> symbol.</p>
<p>Typically, the command <code>ggplot()</code> includes the <code>data =</code> argument for the plot. This sets the default dataset to be used for subsequent layers of the plot.</p>
<p>This command will end with a <code>+</code> after its closing parentheses. This leaves the command “open”. The ggplot will only execute/appear when the full command includes a final layer <em>without</em> a <code>+</code> at the end.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will create plot that is a blank canvas</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geoms" class="level2">
<h2 class="anchored" data-anchor-id="geoms">Geoms</h2>
<p>A blank canvas is certainly not sufficient - we need to create geometries (shapes) from our data (e.g.&nbsp;bar plots, histograms, scatter plots, box plots).</p>
<p>This is done by adding layers “geoms” to the initial <code>ggplot()</code> command. There are many <strong>ggplot2</strong> functions that create “geoms”. Each of these functions begins with “geom_”, so we will refer to them generically as <code>geom_XXXX()</code>. There are over 40 geoms in <strong>ggplot2</strong> and many others created by fans. View them at the <a href="https://exts.ggplot2.tidyverse.org/gallery/">ggplot2 gallery</a>. Some common geoms are listed below:</p>
<ul>
<li>Histograms - <code>geom_histogram()</code><br>
</li>
<li>Bar charts - <code>geom_bar()</code> or <code>geom_col()</code> (see <a href="#ggplot_basics_bars">“Bar plot” section</a>)<br>
</li>
<li>Box plots - <code>geom_boxplot()</code><br>
</li>
<li>Points (e.g.&nbsp;scatter plots) - <code>geom_point()</code><br>
</li>
<li>Line graphs - <code>geom_line()</code> or <code>geom_path()</code><br>
</li>
<li>Trend lines - <code>geom_smooth()</code></li>
</ul>
<p>In one plot you can display one or multiple geoms. Each is added to previous <strong>ggplot2</strong> commands with a <code>+</code>, and they are plotted sequentially such that later geoms are plotted on top of previous ones.</p>
</section>
<section id="ggplot_basics_mapping" class="level2">
<h2 class="anchored" data-anchor-id="ggplot_basics_mapping">Mapping data to the plot</h2>
<p>Most geom functions must be told <em>what to use</em> to create their shapes - so you must tell them how they should <em>map (assign) columns in your data</em> to components of the plot like the axes, shape colors, shape sizes, etc. For most geoms, the <em>essential</em> components that must be mapped to columns in the data are the x-axis, and (if necessary) the y-axis.</p>
<p>This “mapping” occurs with the <code>mapping =</code> argument. The mappings you provide to <code>mapping</code> must be wrapped in the <code>aes()</code> function, so you would write something like <code>mapping = aes(x = col1, y = col2)</code>, as shown below.</p>
<p>Below, in the <code>ggplot()</code> command the data are set as the case <code>linelist</code>. In the <code>mapping = aes()</code> argument the column <code>age</code> is mapped to the x-axis, and the column <code>wt_kg</code> is mapped to the y-axis.</p>
<p>After a <code>+</code>, the plotting commands continue. A shape is created with the “geom” function <code>geom_point()</code>. This geom <em>inherits</em> the mappings from the <code>ggplot()</code> command above - it knows the axis-column assignments and proceeds to visualize those relationships as <em>points</em> on the canvas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As another example, the following commands utilize the same data, a slightly different mapping, and a different geom. The <code>geom_histogram()</code> function only requires a column mapped to the x-axis, as the counts y-axis is generated automatically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="plot-aesthetics" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="plot-aesthetics">Plot aesthetics</h3>
<p>In ggplot terminology a plot “aesthetic” has a specific meaning. It refers to a visual property of <em>plotted data</em>. Note that “aesthetic” here refers to the <em>data being plotted in geoms/shapes</em> - not the surrounding display such as titles, axis labels, background color, that you might associate with the word “aesthetics” in common English. In ggplot those details are called “themes” and are adjusted within a <code>theme()</code> command (see <a href="#ggplot_basics_themes">this section</a>).</p>
<p>Therefore, plot object <em>aesthetics</em> can be colors, sizes, transparencies, placement, etc. <em>of the plotted data</em>. Not all geoms will have the same aesthetic options, but many can be used by most geoms. Here are some examples:</p>
<ul>
<li><code>shape =</code> Display a point with <code>geom_point()</code> as a dot, star, triangle, or square…<br>
</li>
<li><code>fill =</code> The interior color (e.g.&nbsp;of a bar or boxplot)<br>
</li>
<li><code>color =</code> The exterior line of a bar, boxplot, etc., or the point color if using <code>geom_point()</code><br>
</li>
<li><code>size =</code> Size (e.g.&nbsp;line thickness, point size)<br>
</li>
<li><code>alpha =</code> Transparency (1 = opaque, 0 = invisible)<br>
</li>
<li><code>binwidth =</code> Width of histogram bins<br>
</li>
<li><code>width =</code> Width of “bar plot” columns<br>
</li>
<li><code>linetype =</code> Line type (e.g.&nbsp;solid, dashed, dotted)</li>
</ul>
<p>These plot object aesthetics can be assigned values in two ways:</p>
<ol type="1">
<li>Assigned a static value (e.g.&nbsp;<code>color = "blue"</code>) to apply across all plotted observations<br>
</li>
<li>Assigned to a column of the data (e.g.&nbsp;<code>color = hospital</code>) such that display of each observation depends on its value in that column</li>
</ol>
</section>
<section id="set-to-a-static-value" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="set-to-a-static-value">Set to a static value</h3>
<p>If you want the plot object aesthetic to be static, that is - to be the same for every observation in the data, you write its assignment within the geom but <em>outside</em> of any <code>mapping = aes()</code> statement. These assignments could look like <code>size = 1</code> or <code>color = "blue"</code>. Here are two examples:</p>
<ul>
<li>In the first example, the <code>mapping = aes()</code> is in the <code>ggplot()</code> command and the axes are mapped to age and weight columns in the data. The plot aesthetics <code>color =</code>, <code>size =</code>, and <code>alpha =</code> (transparency) are assigned to static values. For clarity, this is done in the <code>geom_point()</code> function, as you may add other geoms afterward that would take different values for their plot aesthetics.<br>
</li>
<li>In the second example, the histogram requires only the x-axis mapped to a column. The histogram <code>binwidth =</code>, <code>color =</code>, <code>fill =</code> (internal color), and <code>alpha =</code> are again set within the geom to static values.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  <span class="co"># set data and axes mapping</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)         <span class="co"># set static point aesthetics</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>       <span class="co"># set data and axes</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(              <span class="co"># display histogram</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">7</span>,                <span class="co"># width of bins</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,               <span class="co"># bin line color</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"blue"</span>,               <span class="co"># bin interior color</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.1</span>)                 <span class="co"># bin transparency</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
<section id="scaled-to-column-values" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="scaled-to-column-values">Scaled to column values</h3>
<p>The alternative is to scale the plot object aesthetic by the values in a column. In this approach, the display of this aesthetic will depend on that observation’s value in that column of the data. If the column values are continuous, the display scale (legend) for that aesthetic will be continuous. If the column values are discrete, the legend will display each value and the plotted data will appear as distinctly “grouped” (read more in the <a href="#ggplotgroups">grouping</a> section of this page).</p>
<p>To achieve this, you map that plot aesthetic to a <em>column name</em> (not in quotes). This must be done <em>within a <code>mapping = aes()</code> function</em> (note: there are several places in the code you can make these mapping assignments, as discussed <a href="##ggplot_basics_map_loc">below</a>).</p>
<p>Two examples are below.</p>
<ul>
<li>In the first example, the <code>color =</code> aesthetic (of each point) is mapped to the column <code>age</code> - and a scale has appeared in a legend! For now just note that the scale exists - we will show how to modify it in later sections.<br>
</li>
<li>In the second example two new plot aesthetics are also mapped to columns (<code>color =</code> and <code>size =</code>), while the plot aesthetics <code>shape =</code> and <code>alpha =</code> are mapped to static values outside of any <code>mapping = aes()</code> function.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,   <span class="co"># set data</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(     <span class="co"># map aesthetics to column values</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,           <span class="co"># map x-axis to age            </span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,         <span class="co"># map y-axis to weight</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>       )<span class="sc">+</span>     <span class="co"># map color to age</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()         <span class="co"># display data as points </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,   <span class="co"># set data</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(     <span class="co"># map aesthetics to column values</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,           <span class="co"># map x-axis to age            </span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,         <span class="co"># map y-axis to weight</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age,       <span class="co"># map color to age</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> age))<span class="sc">+</span>      <span class="co"># map size to age</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(             <span class="co"># display data as points</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"diamond"</span>,      <span class="co"># points display as diamonds</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span>)            <span class="co"># point transparency at 30%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Axes assignments are always assigned to columns in the data (not to static values), and this is always done within <code>mapping = aes()</code>.</p>
</div>
</div>
<p>It becomes important to keep track of your plot layers and aesthetics when making more complex plots - for example plots with multiple geoms. In the example below, the <code>size =</code> aesthetic is assigned twice - once for <code>geom_point()</code> and once for <code>geom_smooth()</code> - both times as a static value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(           <span class="co"># map aesthetics to columns</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age_years)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(                   <span class="co"># add points for each row of data</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(                  <span class="co"># add a trend line </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,              <span class="co"># with linear method</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>)                   <span class="co"># size (width of line) of 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="ggplot_basics_map_loc" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ggplot_basics_map_loc">Where to make mapping assignments</h3>
<p>Aesthetic mapping within <code>mapping = aes()</code> can be written in several places in your plotting commands and can even be written more than once. This can be written in the top <code>ggplot()</code> command, and/or for each individual geom beneath. The nuances include:</p>
<ul>
<li>Mapping assignments made in the top <code>ggplot()</code> command will be inherited as defaults across any geom below, like how <code>x =</code> and <code>y =</code> are inherited</li>
<li>Mapping assignments made within one geom apply only to that geom</li>
</ul>
<p>Likewise, <code>data =</code> specified in the top <code>ggplot()</code> will apply by default to any geom below, but you could also specify data for each geom (but this is more difficult).</p>
<p>Thus, each of the following commands will create the same plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These commands will produce the exact same plot</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ggplotgroups" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ggplotgroups">Groups</h3>
<p>You can easily group the data and “plot by group”. In fact, you have already done this!</p>
<p>Assign the “grouping” column to the appropriate plot aesthetic, within a <code>mapping = aes()</code>. Above, we demonstrated this using continuous values when we assigned point <code>size =</code> to the column <code>age</code>. However this works the same way for discrete/categorical columns.</p>
<p>For example, if you want points to be displayed by gender, you would set <code>mapping = aes(color = gender)</code>. A legend automatically appears. This assignment can be made within the <code>mapping = aes()</code> in the top <code>ggplot()</code> command (and be inherited by the geom), or it could be set in a separate <code>mapping = aes()</code> within the geom. Both approaches are shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg, <span class="at">color =</span> gender))<span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This alternative code produces the same plot</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> gender),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that depending on the geom, you will need to use different arguments to group the data. For <code>geom_point()</code> you will most likely use <code>color =</code>, <code>shape =</code> or <code>size =</code>. Whereas for <code>geom_bar()</code> you are more likely to use <code>fill =</code>. This just depends on the geom and what plot aesthetic you want to reflect the groupings.</p>
<p>For your information - the most basic way of grouping the data is by using only the <code>group =</code> argument within <code>mapping = aes()</code>. However, this by itself will not change the colors, fill, or shapes. Nor will it create a legend. Yet the data are grouped, so statistical displays may be affected.</p>
</section>
</section>
<section id="ggplot_basics_facet" class="level2">
<h2 class="anchored" data-anchor-id="ggplot_basics_facet">Facets / Small-multiples</h2>
<p>Facets, or “small-multiples”, are used to split one plot into a multi-panel figure, with one panel (“facet”) per group of data. The same type of plot is created multiple times, each one using a sub-group of the same dataset.</p>
<p>Faceting is a functionality that comes with <strong>ggplot2</strong>, so the legends and axes of the facet “panels” are automatically aligned. We would need to use other packages to combine completely different plots (<strong>cowplot</strong> and <strong>patchwork</strong>) into one figure.</p>
<p>Faceting is done with one of the following <strong>ggplot2</strong> functions:</p>
<ol type="1">
<li><code>facet_wrap()</code> To show a different panel for each level of a <em>single</em> variable. One example of this could be showing a different epidemic curve for each hospital in a region. Facets are ordered alphabetically, unless the variable is a factor with other ordering defined.<br>
</li>
</ol>
<ul>
<li>You can invoke certain options to determine the layout of the facets, e.g.&nbsp;<code>nrow = 1</code> or <code>ncol = 1</code> to control the number of rows or columns that the faceted plots are arranged within.</li>
</ul>
<ol start="2" type="1">
<li><code>facet_grid()</code> This is used when you want to bring a second variable into the faceting arrangement. Here each panel of a grid shows the intersection between values in <em>two columns</em>. For example, epidemic curves for each hospital-age group combination with hospitals along the top (columns) and age groups along the sides (rows).<br>
</li>
</ol>
<ul>
<li><code>nrow</code> and <code>ncol</code> are not relevant, as the subgroups are presented in a grid</li>
</ul>
<p>Each of these functions accept a formula syntax to specify the column(s) for faceting. Both accept up to two columns, one on each side of a tilde <code>~</code>.</p>
<ul>
<li><p>For <code>facet_wrap()</code> most often you will write only one column preceded by a tilde <code>~</code> like <code>facet_wrap(~hospital)</code>. However you can write two columns <code>facet_wrap(outcome ~ hospital)</code> - each unique combination will display in a separate panel, but they will not be arranged in a grid. The headings will show combined terms and these won’t be specific logic to the columns vs.&nbsp;rows. If you are providing only one faceting variable, a period <code>.</code> is used as a placeholder on the other side of the formula - see the code examples.</p></li>
<li><p>For <code>facet_grid()</code> you can also specify one or two columns to the formula (grid <code>rows ~ columns</code>). If you only want to specify one, you can place a period <code>.</code> on the other side of the tilde like <code>facet_grid(. ~ hospital)</code> or <code>facet_grid(hospital ~ .)</code>.</p></li>
</ul>
<p>Facets can quickly contain an overwhelming amount of information - its good to ensure you don’t have too many levels of each variable that you choose to facet by. Here are some quick examples with the malaria dataset which consists of daily case counts of malaria for facilities, by age group.</p>
<p>Below we import and do some quick modifications for simplicity:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These data are daily counts of malaria cases, by facility-day</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>malaria_data <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"data/malaria_facility_count_data.rds"</span>) <span class="sc">%&gt;%</span>  <span class="co"># import</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>submitted_date, <span class="sc">-</span>Province, <span class="sc">-</span>newid)                                 <span class="co"># remove unneeded columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first 50 rows of the malaria data are below. Note there is a column <code>malaria_tot</code>, but also columns for counts by age group (these will be used in the second, <code>facet_grid()</code> example).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 7
   location_name data_date  District `malaria_rdt_0-4` `malaria_rdt_5-14`
   &lt;chr&gt;         &lt;date&gt;     &lt;chr&gt;                &lt;int&gt;              &lt;int&gt;
 1 Facility 1    2020-08-11 Spring                  11                 12
 2 Facility 2    2020-08-11 Bolo                    11                 10
 3 Facility 3    2020-08-11 Dingo                    8                  5
 4 Facility 4    2020-08-11 Bolo                    16                 16
 5 Facility 5    2020-08-11 Bolo                     9                  2
 6 Facility 6    2020-08-11 Dingo                    3                  1
 7 Facility 6    2020-08-10 Dingo                    4                  0
 8 Facility 5    2020-08-10 Bolo                    15                 14
 9 Facility 5    2020-08-09 Bolo                    11                 11
10 Facility 5    2020-08-08 Bolo                    19                 15
# ℹ 40 more rows
# ℹ 2 more variables: malaria_rdt_15 &lt;int&gt;, malaria_tot &lt;int&gt;</code></pre>
</div>
</div>
<section id="facet_wrap" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="facet_wrap"><code>facet_wrap()</code></h3>
<p>For the moment, let’s focus on the columns <code>malaria_tot</code> and <code>District</code>. Ignore the age-specific count columns for now. We will plot epidemic curves with <code>geom_col()</code>, which produces a column for each day at the specified y-axis height given in column <code>malaria_tot</code> (the data are already daily counts, so we use <code>geom_col()</code> - see <a href="#ggplot_basics_bars">the “Bar plot” section below</a>).</p>
<p>When we add the command <code>facet_wrap()</code>, we specify a tilde and then the column to facet on (<code>District</code> in this case). You can place another column on the left side of the tilde, - this will create one facet for each combination - but we recommend you do this with <code>facet_grid()</code> instead. In this use case, one facet is created for each unique value of <code>District</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A plot with facets by district</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> malaria_tot)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>) <span class="sc">+</span>       <span class="co"># plot the count data as columns</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                              <span class="co"># simplify the background panels</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(                                         <span class="co"># add plot labels, title, etc.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date of report"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Malaria cases"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Malaria cases by district"</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>District)                       <span class="co"># the facets are created</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="facet_grid" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="facet_grid"><code>facet_grid()</code></h3>
<p>We can use a <code>facet_grid()</code> approach to cross two variables. Let’s say we want to cross <code>District</code> and age. Well, we need to do some data transformations on the age columns to get these data into ggplot-preferred “long” format. The age groups all have their own columns - we want them in a single column called <code>age_group</code> and another called <code>num_cases</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>malaria_age <span class="ot">&lt;-</span> malaria_data <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>malaria_tot) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">"malaria_rdt_"</span>)),  <span class="co"># choose columns to pivot longer</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"age_group"</span>,      <span class="co"># column names become age group</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"num_cases"</span>      <span class="co"># values to a single column (num_cases)</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">str_replace</span>(age_group, <span class="st">"malaria_rdt_"</span>, <span class="st">""</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(age_group, <span class="st">"5-14"</span>, <span class="at">after =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now the first 50 rows of data look like this:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 5
   location_name data_date  District age_group num_cases
   &lt;chr&gt;         &lt;date&gt;     &lt;chr&gt;    &lt;fct&gt;         &lt;int&gt;
 1 Facility 1    2020-08-11 Spring   0-4              11
 2 Facility 1    2020-08-11 Spring   5-14             12
 3 Facility 1    2020-08-11 Spring   15               23
 4 Facility 2    2020-08-11 Bolo     0-4              11
 5 Facility 2    2020-08-11 Bolo     5-14             10
 6 Facility 2    2020-08-11 Bolo     15                5
 7 Facility 3    2020-08-11 Dingo    0-4               8
 8 Facility 3    2020-08-11 Dingo    5-14              5
 9 Facility 3    2020-08-11 Dingo    15                5
10 Facility 4    2020-08-11 Bolo     0-4              16
# ℹ 40 more rows</code></pre>
</div>
</div>
<p>When you pass the two variables to <code>facet_grid()</code>, easiest is to use formula notation (e.g.&nbsp;<code>x ~ y</code>) where x is rows and y is columns. Here is the plot, using <code>facet_grid()</code> to show the plots for each combination of the columns <code>age_group</code> and <code>District</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_age, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> num_cases)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkred"</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date of report"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Malaria cases"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Malaria cases by district and age group"</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(District <span class="sc">~</span> age_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="free-or-fixed-axes" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="free-or-fixed-axes">Free or fixed axes</h3>
<p>The axes scales displayed when faceting are by default the same (fixed) across all the facets. This is helpful for cross-comparison, but not always appropriate.</p>
<p>When using <code>facet_wrap()</code> or <code>facet_grid()</code>, we can add <code>scales = "free_y"</code> to “free” or release the y-axes of the panels to scale appropriately to their data subset. This is particularly useful if the actual counts are small for one of the subcategories and trends are otherwise hard to see. Instead of “free_y” we can also write “free_x” to do the same for the x-axis (e.g.&nbsp;for dates) or “free” for both axes. Note that in <code>facet_grid</code>, the y scales will be the same for facets in the same row, and the x scales will be the same for facets in the same column.</p>
<p>When using <code>facet_grid</code> only, we can add <code>space = "free_y"</code> or <code>space = "free_x"</code> so that the actual height or width of the facet is weighted to the values of the figure within. This only works if <code>scales = "free"</code> (y or x) is already applied.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Free y-axis</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> malaria_tot)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>) <span class="sc">+</span>       <span class="co"># plot the count data as columns</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                              <span class="co"># simplify the background panels</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(                                         <span class="co"># add plot labels, title, etc.</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date of report"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Malaria cases"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Malaria cases by district - 'free' x and y axes"</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>District, <span class="at">scales =</span> <span class="st">"free"</span>)        <span class="co"># the facets are created</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="exporting-plots" class="level2">
<h2 class="anchored" data-anchor-id="exporting-plots">Exporting plots</h2>
<p>Exporting ggplots is made easy with the <code>ggsave()</code> function from <strong>ggplot2</strong>. It can work in two ways, either:</p>
<ul>
<li>Specify the name of the plot object, then the file path and name with extension
<ul>
<li>For example: <code>ggsave(my_plot, "plots/my_plot.png"))</code><br>
</li>
</ul></li>
<li>Run the command with only a file path, to save the last plot that was printed
<ul>
<li>For example: <code>ggsave("plots/my_plot.png"))</code></li>
</ul></li>
</ul>
<p>You can export as png, pdf, jpeg, tiff, bmp, svg, or several other file types, by specifying the file extension in the file path.</p>
<p>You can also specify the arguments <code>width =</code>, <code>height =</code>, and <code>units =</code> (either “in”, “cm”, or “mm”). You can also specify <code>dpi =</code> with a number for plot resolution (e.g.&nbsp;300). See the function details by entering <code>?ggsave</code> or reading the <a href="https://ggplot2.tidyverse.org/reference/ggsave.html">documentation online</a>.</p>
</section>
<section id="labels" class="level2">
<h2 class="anchored" data-anchor-id="labels">Labels</h2>
<p>Surely you will want to add or adjust the plot’s labels. These are most easily done within the <code>labs()</code> function which is added to the plot with <code>+</code> just as the geoms were.</p>
<p>Within <code>labs()</code> you can provide character strings to these arguements:</p>
<ul>
<li><code>x =</code> and <code>y =</code> The x-axis and y-axis title (labels)<br>
</li>
<li><code>title =</code> The main plot title<br>
</li>
<li><code>subtitle =</code> The subtitle of the plot, in smaller text below the title<br>
</li>
<li><code>caption =</code> The caption of the plot, in bottom-right by default</li>
</ul>
<p>Here is a plot we made earlier, but with nicer labels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>age_by_wt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> linelist,   <span class="co"># set data</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(     <span class="co"># map aesthetics to column values</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> age,           <span class="co"># map x-axis to age            </span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> wt_kg,         <span class="co"># map y-axis to weight</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> age))<span class="sc">+</span>     <span class="co"># map color to age</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span>           <span class="co"># display data as points</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Age and weight distribution"</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Fictional Ebola outbreak, 2014"</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age in years"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Weight in kilos"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Age"</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">"Data as of {max(linelist$date_hospitalisation, na.rm=T)}"</span>))</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>age_by_wt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note how in the caption assignment we used <code>str_glue()</code> from the <strong>stringr</strong> package to implant dynamic R code within the string text. The caption will show the “Data as of:” date that reflects the maximum hospitalization date in the linelist.</p>
</section>
<section id="plot-continuous-data" class="level2">
<h2 class="anchored" data-anchor-id="plot-continuous-data">Plot continuous data</h2>
<p>Throughout this page, you have already seen many examples of plotting continuous data. Here we briefly consolidate these and present a few variations.<br>
Visualisations covered here include:</p>
<ul>
<li>Plots for one continuous variable:
<ul>
<li><strong>Histogram</strong>, a classic graph to present the distribution of a continuous variable.</li>
<li><strong>Box plot</strong> (also called box and whisker), to show the 25th, 50th, and 75th percentiles, tail ends of the distribution, and outliers (<a href="https://www.data-to-viz.com/caveat/boxplot.html">important limitations</a>).<br>
</li>
<li><strong>Jitter plot</strong>, to show all values as points that are ‘jittered’ so they can (mostly) all be seen, even where two have the same value.<br>
</li>
<li><strong>Violin plot</strong>, show the distribution of a continuous variable based on the symmetrical width of the ‘violin’.</li>
<li><strong>Sina plot</strong>, are a combination of jitter and violin plots, where individual points are shown but in the symmetrical shape of the distribution (via <strong>ggforce</strong> package).<br>
</li>
</ul></li>
<li><strong>Scatter plot</strong> for two continuous variables.<br>
</li>
<li><strong>Heat plots</strong> for three continuous variables</li>
</ul>
<section id="histograms" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="histograms">Histograms</h3>
<p>Histograms may look like bar charts, but are distinct because they measure the distribution of a <em>continuous</em> variable. There are no spaces between the “bars”, and only one column is provided to <code>geom_histogram()</code>.</p>
<p>Below is code for generating <strong>histograms</strong>, which group continuous data into ranges and display in adjacent bars of varying height. This is done using <code>geom_histogram()</code>. See the <a href="#ggplot_basics_bars">“Bar plot” section</a> of the ggplot basics page to understand difference between <code>geom_histogram()</code>, <code>geom_bar()</code>, and <code>geom_col()</code>.</p>
<p>We will show the distribution of ages of cases. Within <code>mapping = aes()</code> specify which column you want to see the distribution of. You can assign this column to either the x or the y axis.</p>
<p>The rows will be assigned to “bins” based on their numeric age, and these bins will be graphically represented by bars. If you specify a number of bins with the <code>bins =</code> plot aesthetic, the break points are evenly spaced between the minimum and maximum values of the histogram. If <code>bins =</code> is unspecified, an appropriate number of bins will be guessed and this message displayed after the plot:</p>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p>If you do not want to specify a number of bins to <code>bins =</code>, you could alternatively specify <code>binwidth =</code> in the units of the axis. We give a few examples showing different bins and bin widths:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Regular histogram</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>  <span class="co"># provide x variable</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) Default histogram (30 bins)"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># B) More bins</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>  <span class="co"># provide x variable</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>)<span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) Set to 50 bins"</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># C) Fewer bins</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>  <span class="co"># provide x variable</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"C) Set to 5 bins"</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"># D) More bins</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>  <span class="co"># provide x variable</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"D) binwidth of 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-30-3.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-30-4.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
<p>To get smoothed proportions, you can use <code>geom_density()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequency with proportion axis, smoothed</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proportional density"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Stacked frequency with proportion axis, smoothed</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">fill =</span> gender)) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">"stack"</span>)<span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"'Stacked' proportional densities"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
<p>To get a “stacked” histogram (of a continuous column of data), you can do one of the following:</p>
<ol type="1">
<li>Use <code>geom_histogram()</code> with the <code>fill =</code> argument within <code>aes()</code> and assigned to the grouping column, or<br>
</li>
<li>Use <code>geom_freqpoly()</code>, which is likely easier to read (you can still set <code>binwidth =</code>)<br>
</li>
<li>To see proportions of all values, set the <code>y = after_stat(density)</code> (use this syntax exactly - not changed for your data). Note: these proportions will show <em>per group</em>.</li>
</ol>
<p>Each is shown below (*note use of <code>color =</code> vs.&nbsp;<code>fill =</code> in each):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># "Stacked" histogram</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">fill =</span> gender)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"'Stacked' histogram"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequency </span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Freqpoly"</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequency with proportion axis</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> <span class="fu">after_stat</span>(density), <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proportional freqpoly"</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequency with proportion axis, smoothed</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> <span class="fu">after_stat</span>(density), <span class="at">fill =</span> gender)) <span class="sc">+</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proportional, smoothed with geom_density()"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-32-3.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-32-4.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
<p>If you want to have some fun, try <code>geom_density_ridges</code> from the <strong>ggridges</strong> package (<a href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html">vignette here</a>.</p>
<p>Read more in detail about histograms at the <strong>tidyverse</strong> <a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">page on geom_histogram()</a>.</p>
</section>
<section id="box-plots" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="box-plots">Box plots</h3>
<p>Box plots are common, but have important limitations. They can obscure the actual distribution - e.g.&nbsp;a bi-modal distribution. See this <a href="https://www.r-graph-gallery.com/boxplot.html">R graph gallery</a> and this <a href="https://www.data-to-viz.com/caveat/boxplot.html">data-to-viz article</a> for more details. However, they do nicely display the inter-quartile range and outliers - so they can be overlaid on top of other types of plots that show the distribution in more detail.</p>
<p>Below we remind you of the various components of a boxplot:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/boxplot.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>When using <code>geom_boxplot()</code> to create a box plot, you generally map only one axis (x or y) within <code>aes()</code>. The axis specified determines if the plots are horizontal or vertical.</p>
<p>In most geoms, you create a plot per group by mapping an aesthetic like <code>color =</code> or <code>fill =</code> to a column within <code>aes()</code>. However, for box plots achieve this by assigning the grouping column to the un-assigned axis (x or y). Below is code for a boxplot of <em>all</em> age values in the dataset, and second is code to display one box plot for each (non-missing) gender in the dataset. Note that <code>NA</code> (missing) values will appear as a separate box plot unless removed. In this example we also set the <code>fill</code> to the column <code>outcome</code> so each plot is a different color - but this is not necessary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Overall boxplot</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span>  </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> age))<span class="sc">+</span>   <span class="co"># only y axis mapped (not x)</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) Overall boxplot"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Box plot by group</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> age, <span class="at">x =</span> gender, <span class="at">fill =</span> gender)) <span class="sc">+</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span>                     </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span>   <span class="co"># remove legend (redundant)</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) Boxplot by gender"</span>)      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
<section id="violin-jitter-and-sina-plots" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="violin-jitter-and-sina-plots">Violin, jitter, and sina plots</h3>
<p>Below is code for creating <strong>violin plots</strong> (<code>geom_violin</code>) and <strong>jitter plots</strong> (<code>geom_jitter</code>) to show distributions. You can specify that the fill or color is also determined by the data, by inserting these options within <code>aes()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Jitter plot by group</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome),      <span class="co"># remove missing values</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> age,                     <span class="co"># Continuous variable</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> outcome,                           <span class="co"># Grouping variable</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> outcome))<span class="sc">+</span>                     <span class="co"># Color variable</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()<span class="sc">+</span>                                  <span class="co"># Create the violin plot</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) jitter plot by gender"</span>)     </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Violin plot by group</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome),       <span class="co"># remove missing values</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> age,                      <span class="co"># Continuous variable</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> outcome,                            <span class="co"># Grouping variable</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> outcome))<span class="sc">+</span>                       <span class="co"># fill variable (color)</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>()<span class="sc">+</span>                                   <span class="co"># create the violin plot</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) violin plot by gender"</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
<p>You can combine the two using the <code>geom_sina()</code> function from the <strong>ggforce</strong> package. The sina plots the jitter points in the shape of the violin plot. When overlaid on the violin plot (adjusting the transparencies) this can be easier to visually interpret.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Sina plot by group</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome), </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> age,           <span class="co"># numeric variable</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> outcome)) <span class="sc">+</span>    <span class="co"># group variable</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> outcome), <span class="co"># fill (color of violin background)</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span>,     <span class="co"># white outline</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span>        <span class="co"># transparency</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sina</span>(</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span><span class="dv">1</span>,                <span class="co"># Change the size of the jitter</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> outcome))<span class="sc">+</span> <span class="co"># color (color of dots)</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(       <span class="co"># Define fill for violin background by death/recover</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Death"</span> <span class="ot">=</span> <span class="st">"#bf5300"</span>, </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Recover"</span> <span class="ot">=</span> <span class="st">"#11118c"</span>)) <span class="sc">+</span> </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(      <span class="co"># Define colours for points by death/recover</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Death"</span> <span class="ot">=</span> <span class="st">"#bf5300"</span>, </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Recover"</span> <span class="ot">=</span> <span class="st">"#11118c"</span>)) <span class="sc">+</span> </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>                                <span class="co"># Remove the gray background</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span>                <span class="co"># Remove unnecessary legend</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) violin and sina plot by gender, with extra formatting"</span>)      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="two-continuous-variables" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="two-continuous-variables">Two continuous variables</h3>
<p>Following similar syntax, <code>geom_point()</code> will allow you to plot two continuous variables against each other in a <strong>scatter plot</strong>. This is useful for showing actual values rather than their distributions. A basic scatter plot of age vs weight is shown in (A). In (B) we again use <code>facet_grid()</code> to show the relationship between two continuous variables in the linelist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic scatter plot of weight and age</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> wt_kg, <span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) Scatter plot of weight and age"</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot of weight and age by gender and Ebola outcome</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(gender, outcome), <span class="co"># filter retains non-missing gender/outcome</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> wt_kg, <span class="at">x =</span> age))<span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) Scatter plot of weight and age faceted by gender and outcome"</span>)<span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(gender <span class="sc">~</span> outcome) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
<section id="three-continuous-variables" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="three-continuous-variables">Three continuous variables</h3>
<p>You can display three continuous variables by utilizing the <code>fill =</code> argument to create a <em>heat plot</em>. The color of each “cell” will reflect the value of the third continuous column of data. There are ways to make 3D plots in R, but for applied epidemiology these are often difficult to interpret and therefore less useful for decision-making.</p>
</section>
</section>
<section id="plot-categorical-data" class="level2">
<h2 class="anchored" data-anchor-id="plot-categorical-data">Plot categorical data</h2>
<p>Categorical data can be character values, could be logical (TRUE/FALSE), or factors.</p>
<section id="preparation" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="preparation">Preparation</h3>
<section id="data-structure" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="data-structure">Data structure</h4>
<p>The first thing to understand about your categorical data is whether it exists as raw observations like a linelist of cases, or as a summary or aggregate data frame that holds counts or proportions. The state of your data will impact which plotting function you use:</p>
<ul>
<li>If your data are raw observations with one row per observation, you will likely use <code>geom_bar()</code><br>
</li>
<li>If your data are already aggregated into counts or proportions, you will likely use <code>geom_col()</code></li>
</ul>
</section>
<section id="column-class-and-value-ordering" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="column-class-and-value-ordering">Column class and value ordering</h4>
<p>Next, examine the class of the columns you want to plot. We look at <code>hospital</code>, first with <code>class()</code> from <strong>base</strong> R, and with <code>tabyl()</code> from <strong>janitor</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View class of hospital column - we can see it is a character</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>hospital)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at values and proportions within hospital column</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(hospital)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             hospital    n    percent
                     Central Hospital  454 0.07710598
                    Military Hospital  896 0.15217391
                              Missing 1469 0.24949049
                                Other  885 0.15030571
                        Port Hospital 1762 0.29925272
 St. Mark's Maternity Hospital (SMMH)  422 0.07167120</code></pre>
</div>
</div>
<p>We can see the values within are characters, as they are hospital names, and by default they are ordered alphabetically. There are ‘other’ and ‘missing’ values, which we would prefer to be the last subcategories when presenting breakdowns. So we change this column into a factor and re-order it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to factor and define level order so "Other" and "Missing" are last</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hospital =</span> <span class="fu">fct_relevel</span>(hospital, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Port Hospital"</span>, </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Central Hospital"</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Military Hospital"</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Other"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Missing"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(linelist<span class="sc">$</span>hospital)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "St. Mark's Maternity Hospital (SMMH)"
[2] "Port Hospital"                       
[3] "Central Hospital"                    
[4] "Military Hospital"                   
[5] "Other"                               
[6] "Missing"                             </code></pre>
</div>
</div>
</section>
</section>
<section id="ggplot_basics_bars" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ggplot_basics_bars"><code>geom_bar()</code></h3>
<p>Use <code>geom_bar()</code> if you want bar height (or the height of stacked bar components) to reflect <em>the number of relevant rows in the data</em>. These bars will have gaps between them, unless the <code>width =</code> plot aesthetic is adjusted.</p>
<ul>
<li>Provide only one axis column assignment (typically x-axis). If you provide x and y, you will get <code>Error: stat_count() can only have an x or y aesthetic.</code><br>
</li>
<li>You can create stacked bars by adding a <code>fill =</code> column assignment within <code>mapping = aes()</code><br>
</li>
<li>The opposite axis will be titled “count” by default, because it represents the number of rows</li>
</ul>
<p>Below, we have assigned outcome to the y-axis, but it could just as easily be on the x-axis. If you have longer character values, it can sometimes look better to flip the bars sideways and put the legend on the bottom. This may impact how your factor levels are ordered - in this case we reverse them with <code>fct_rev()</code> to put missing and other at the bottom.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A) Outcomes in all cases</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome)) <span class="sc">+</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fct_rev</span>(hospital)), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"A) Number of cases by hospital"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Hospital"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># B) Outcomes in all cases by hosptial</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(outcome)) <span class="sc">+</span> </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fct_rev</span>(hospital), <span class="at">fill =</span> outcome), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"B) Number of recovered and dead Ebola cases, by hospital"</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Hospital"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-41-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
<section id="geom_col" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="geom_col"><code>geom_col()</code></h3>
<p>Use <code>geom_col()</code> if you want bar height (or height of stacked bar components) to reflect pre-calculated <em>values</em> that exists in the data. Often, these are summary or “aggregated” counts, or proportions.</p>
<p>Provide column assignments for <em>both</em> axes to <code>geom_col()</code>. Typically your x-axis column is discrete and your y-axis column is numeric.</p>
<p>Let’s say we have this dataset <code>outcomes</code>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  outcome     n proportion
  &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
1 Death    1022       56.2
2 Recover   796       43.8</code></pre>
</div>
</div>
<p>Below is code using <code>geom_col</code> for creating simple bar charts to show the distribution of Ebola patient outcomes. With geom_col, both x and y need to be specified. Here x is the categorical variable along the x axis, and y is the generated proportions column <code>proportion</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcomes in all cases</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outcomes) <span class="sc">+</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>outcome, <span class="at">y =</span> proportion)) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Number of recovered and dead Ebola cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="432"></p>
</div>
</div>
<p>To show breakdowns by hospital, we would need our table to contain more information, and to be in “long” format. We create this table with the frequencies of the combined categories <code>outcome</code> and <code>hospital</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>outcomes2 <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hospital, outcome) <span class="sc">%&gt;%</span>  <span class="co"># get counts by hospital and outcome</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span>        <span class="co"># Group so proportions are out of hospital total</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)<span class="sc">*</span><span class="dv">100</span>) <span class="co"># calculate proportions of hospital total</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(outcomes2) <span class="co"># Preview data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   hospital [3]
  hospital                             outcome     n proportion
  &lt;fct&gt;                                &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
1 St. Mark's Maternity Hospital (SMMH) Death     199       61.2
2 St. Mark's Maternity Hospital (SMMH) Recover   126       38.8
3 Port Hospital                        Death     785       57.6
4 Port Hospital                        Recover   579       42.4
5 Central Hospital                     Death     193       53.9
6 Central Hospital                     Recover   165       46.1</code></pre>
</div>
</div>
<p>We then create the ggplot with some added formatting:</p>
<ul>
<li><strong>Axis flip</strong>: Swapped the axis around with <code>coord_flip()</code> so that we can read the hospital names.</li>
<li><strong>Columns side-by-side</strong>: Added a <code>position = "dodge"</code> argument so that the bars for death and recover are presented side by side rather than stacked. Note stacked bars are the default.</li>
<li><strong>Column width</strong>: Specified ‘width’, so the columns are half as thin as the full possible width.</li>
<li><strong>Column order</strong>: Reversed the order of the categories on the y axis so that ‘Other’ and ‘Missing’ are at the bottom, with <code>scale_x_discrete(limits=rev)</code>. Note that we used that rather than <code>scale_y_discrete</code> because hospital is stated in the <code>x</code> argument of <code>aes()</code>, even if visually it is on the y axis. We do this because Ggplot seems to present categories backwards unless we tell it not to.<br>
</li>
<li><strong>Other details</strong>: Labels/titles and colours added within <code>labs</code> and <code>scale_fill_color</code> respectively.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcomes in all cases by hospital</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outcomes2) <span class="sc">+</span>  </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> proportion,                 <span class="co"># show pre-calculated proportion values</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">fct_rev</span>(hospital),          <span class="co"># reverse level order so missing/other at bottom</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> outcome),                <span class="co"># stacked by outcome</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.5</span>)<span class="sc">+</span>                    <span class="co"># thinner bars (out of 1)</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>                  <span class="co"># Minimal theme </span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)<span class="sc">+</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Number of recovered and dead Ebola cases, by hospital"</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Outcome"</span>,             <span class="co"># legend title</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>,                  <span class="co"># y axis title</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Hospital of admission"</span>)<span class="sc">+</span> <span class="co"># x axis title</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(                 <span class="co"># adding colors manually</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Death"</span><span class="ot">=</span> <span class="st">"#3B1c8C"</span>,</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Recover"</span> <span class="ot">=</span> <span class="st">"#21908D"</span> )) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Note that the proportions are binary, so we may prefer to drop ‘recover’ and just show the proportion who died. This is just for illustration purposes.</p>
<p>If using <code>geom_col()</code> with dates data (e.g.&nbsp;an epicurve from aggregated data) - you will want to adjust the <code>width =</code> argument to remove the “gap” lines between the bars. If using daily data set <code>width = 1</code>. If weekly, <code>width = 7</code>. Months are not possible because each month has a different number of days.</p>
</section>
</section>
<section id="ggplot_basics_themes" class="level2">
<h2 class="anchored" data-anchor-id="ggplot_basics_themes">Themes</h2>
<p>One of the best parts of <strong>ggplot2</strong> is the amount of control you have over the plot - you can define anything! As mentioned above, the design of the plot that is <em>not</em> related to the data shapes/geometries are adjusted within the <code>theme()</code> function. For example, the plot background color, presence/absence of gridlines, and the font/size/color/alignment of text (titles, subtitles, captions, axis text…). These adjustments can be done in one of two ways:</p>
<ul>
<li>Add a <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><em>complete theme</em></a> <code>theme_()</code> function to make sweeping adjustments - these include <code>theme_classic()</code>, <code>theme_minimal()</code>, <code>theme_dark()</code>, <code>theme_light()</code> <code>theme_grey()</code>, <code>theme_bw()</code> among others<br>
</li>
<li>Adjust each tiny aspect of the plot individually within <code>theme()</code></li>
</ul>
<section id="complete-themes" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="complete-themes">Complete themes</h3>
<p>As they are quite straight-forward, we will demonstrate the complete theme functions below and will not describe them further here. Note that any micro-adjustments with <code>theme()</code> should be made <em>after</em> use of a complete theme.</p>
<p>Write them with empty parentheses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Theme classic"</span>)<span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Theme bw"</span>)<span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Theme minimal"</span>)<span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>  </span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Theme gray"</span>)<span class="sc">+</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_gray</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-46-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-46-3.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-46-4.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
<section id="modify-theme" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="modify-theme">Modify theme</h3>
<p>The <code>theme()</code> function can take a large number of arguments, each of which edits a very specific aspect of the plot. There is no way we could cover all of the arguments, but we will describe the general pattern for them and show you how to find the argument name that you need. The basic syntax is this:</p>
<ol type="1">
<li>Within <code>theme()</code> write the argument name for the plot element you want to edit, like <code>plot.title =</code><br>
</li>
<li>Provide an <code>element_()</code> function to the argument<br>
</li>
</ol>
<ul>
<li>Most often, use <code>element_text()</code>, but others include <code>element_rect()</code> for canvas background colors, or <code>element_blank()</code> to remove plot elements<br>
</li>
</ul>
<ol start="4" type="1">
<li>Within the <code>element_()</code> function, write argument assignments to make the fine adjustments you desire</li>
</ol>
<p>So, that description was quite abstract, so here are some examples.</p>
<p>The below plot looks quite silly, but it serves to show you a variety of the ways you can adjust your plot.</p>
<ul>
<li>We begin with the plot <code>age_by_wt</code> defined just above and add <code>theme_classic()</code><br>
</li>
<li>For finer adjustments we add <code>theme()</code> and include one argument for each plot element to adjust</li>
</ul>
<p>It can be nice to organize the arguments in logical sections. To describe just some of those used below:</p>
<ul>
<li><code>legend.position =</code> is unique in that it accepts simple values like “bottom”, “top”, “left”, and “right”. But generally, text-related arguments require that you place the details <em>within</em> <code>element_text()</code>.<br>
</li>
<li>Title size with <code>element_text(size = 30)</code><br>
</li>
<li>The caption horizontal alignment with <code>element_text(hjust = 0)</code> (from right to left)<br>
</li>
<li>The subtitle is italicized with <code>element_text(face = "italic")</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>age_by_wt <span class="sc">+</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span>                                 <span class="co"># pre-defined theme adjustments</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,                    <span class="co"># move legend to bottom</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),          <span class="co"># size of title to 30</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),        <span class="co"># left-align caption</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>), <span class="co"># italicize subtitle</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">15</span>, <span class="at">angle =</span> <span class="dv">90</span>), <span class="co"># adjusts only x-axis text</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),         <span class="co"># adjusts only y-axis text</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)           <span class="co"># adjusts both axes titles</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    )     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here are some especially common <code>theme()</code> arguments. You will recognize some patterns, such as appending <code>.x</code> or <code>.y</code> to apply the change only to one axis.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 49%">
</colgroup>
<thead>
<tr class="header">
<th><code>theme()</code> argument</th>
<th>What it adjusts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>plot.title = element_text()</code></td>
<td>The title</td>
</tr>
<tr class="even">
<td><code>plot.subtitle = element_text()</code></td>
<td>The subtitle</td>
</tr>
<tr class="odd">
<td><code>plot.caption = element_text()</code></td>
<td>The caption (family, face, color, size, angle, vjust, hjust…)</td>
</tr>
<tr class="even">
<td><code>axis.title = element_text()</code></td>
<td>Axis titles (both x and y) (size, face, angle, color…)</td>
</tr>
<tr class="odd">
<td><code>axis.title.x = element_text()</code></td>
<td>Axis title x-axis only (use <code>.y</code> for y-axis only)</td>
</tr>
<tr class="even">
<td><code>axis.text = element_text()</code></td>
<td>Axis text (both x and y)</td>
</tr>
<tr class="odd">
<td><code>axis.text.x = element_text()</code></td>
<td>Axis text x-axis only (use <code>.y</code> for y-axis only)</td>
</tr>
<tr class="even">
<td><code>axis.ticks = element_blank()</code></td>
<td>Remove axis ticks</td>
</tr>
<tr class="odd">
<td><code>axis.line = element_line()</code></td>
<td>Axis lines (colour, size, linetype: solid dashed dotted etc)</td>
</tr>
<tr class="even">
<td><code>strip.text = element_text()</code></td>
<td>Facet strip text (colour, face, size, angle…)</td>
</tr>
<tr class="odd">
<td><code>strip.background = element_rect()</code></td>
<td>facet strip (fill, colour, size…)</td>
</tr>
</tbody>
</table>
<p>But there are so many theme arguments! How could I remember them all? Do not worry - it is impossible to remember them all. Luckily there are a few tools to help you:</p>
<p>The <strong>tidyverse</strong> documentation on <a href="https://ggplot2.tidyverse.org/reference/theme.html">modifying theme</a>, which has a complete list.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Run <code>theme_get()</code> from <strong>ggplot2</strong> to print a list of all 90+ <code>theme()</code> arguments to the console.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you ever want to remove an element of a plot, you can also do it through <code>theme()</code>. Just pass <code>element_blank()</code> to an argument to have it disappear completely. For legends, set <code>legend.position = "none".</code></p>
</div>
</div>
</section>
</section>
<section id="ggplot_tips_colors" class="level2">
<h2 class="anchored" data-anchor-id="ggplot_tips_colors">Scales for color, fill, axes, etc.</h2>
<p>In <strong>ggplot2</strong>, when aesthetics of plotted data (e.g.&nbsp;size, color, shape, fill, plot axis) are mapped to columns in the data, the exact display can be adjusted with the corresponding “scale” command. In this section we explain some common scale adjustments.</p>
<section id="color-schemes" class="level3">
<h3 class="anchored" data-anchor-id="color-schemes">Color schemes</h3>
<p>One thing that can initially be difficult to understand with <strong>ggplot2</strong> is control of color schemes. Note that this section discusses the color of <em>plot objects</em> (geoms/shapes) such as points, bars, lines, tiles, etc.</p>
<p>To control “color” of <em>plot objects</em> you will be adjusting either the <code>color =</code> aesthetic (the <em>exterior</em> color) or the <code>fill =</code> aesthetic (the <em>interior</em> color). One exception to this pattern is <code>geom_point()</code>, where you really only get to control <code>color =</code>, which controls the color of the point (interior and exterior).</p>
<p>When setting colour or fill you can use colour names recognized by R like <code>"red"</code> (see <a href="http://sape.inf.usi.ch/quick-reference/ggplot2/colour">complete list</a> or enter <code>?colors</code>), or a specific hex colour such as <code>"#ff0505"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram - </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age))<span class="sc">+</span>       <span class="co"># set data and axes</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(              <span class="co"># display histogram</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">7</span>,                <span class="co"># width of bins</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,               <span class="co"># bin line color</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"lightblue"</span>)          <span class="co"># bin interior color (fill) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Aesthetics such as <code>fill =</code> and <code>color =</code> can be defined either <em>outside</em> of a <code>mapping = aes()</code> statement or <em>inside</em> of one. If <em>outside</em> the <code>aes()</code>, the assigned value should be static (e.g.&nbsp;<code>color = "blue"</code>) and will apply for <em>all</em> data plotted by the geom. If <em>inside</em>, the aesthetic should be mapped to a column, like <code>color = hospital</code>, and the expression will vary by the value for that row in the data. A few examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Static color for points and for line</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>     </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"purple"</span>)<span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">50</span>, <span class="at">color =</span> <span class="st">"orange"</span>)<span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Static color for points and line"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Color mapped to continuous column</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>     </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> temp))<span class="sc">+</span>         </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Color mapped to continuous column"</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Color mapped to discrete column</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wt_kg))<span class="sc">+</span>     </span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> gender))<span class="sc">+</span>         </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Color mapped to discrete column"</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co"># bar plot, fill to discrete column, color to static value</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospital))<span class="sc">+</span>     </span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> gender), <span class="at">color =</span> <span class="st">"yellow"</span>)<span class="sc">+</span>         </span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Fill mapped to discrete column, static color"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-49-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-49-3.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-49-4.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
<section id="ggplot_tips_scales" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ggplot_tips_scales">Scales</h3>
<p>Once you map a column to a plot aesthetic (e.g.&nbsp;<code>x =</code>, <code>y =</code>, <code>fill =</code>, <code>color =</code>…), your plot will gain a scale/legend. See above how the scale can be continuous, discrete, date, etc. values depending on the class of the assigned column. If you have multiple aesthetics mapped to columns, your plot will have multiple scales.</p>
<p>You can control the scales with the appropriate <code>scales_()</code> function. The scale functions of <strong>ggplot()</strong> have 3 parts that are written like this: <code>scale_AESTHETIC_METHOD()</code>.</p>
<ol type="1">
<li>The first part, <code>scale_()</code>, is fixed.<br>
</li>
<li>The second part, the AESTHETIC, should be the aesthetic that you want to adjust the scale for (<code>_fill_</code>, <code>_shape_</code>, <code>_color_</code>, <code>_size_</code>, <code>_alpha_</code>…) - the options here also include <code>_x_</code> and <code>_y_</code>.<br>
</li>
<li>The third part, the METHOD, will be either <code>_discrete()</code>, <code>continuous()</code>, <code>_date()</code>, <code>_gradient()</code>, or <code>_manual()</code> depending on the class of the column and <em>how</em> you want to control it. There are others, but these are the most-often used.</li>
</ol>
<p>Be sure that you use the correct function for the scale! Otherwise your scale command will not appear to change anything. If you have multiple scales, you may use multiple scale functions to adjust them! For example:</p>
</section>
<section id="scale-arguments" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="scale-arguments">Scale arguments</h3>
<p>Each kind of scale has its own arguments, though there is some overlap. Query the function like <code>?scale_color_discrete</code> in the R console to see the function argument documentation.</p>
<p>For continuous scales, use <code>breaks =</code> to provide a sequence of values with <code>seq()</code> (take <code>to =</code>, <code>from =</code>, and <code>by =</code> as shown in the example below. Set <code>expand = c(0,0)</code> to eliminate padding space around the axes (this can be used on any <code>_x_</code> or <code>_y_</code> scale.</p>
<p>For discrete scales, you can adjust the order of level appearance with <code>breaks =</code>, and how the values display with the <code>labels =</code> argument. Provide a character vector to each of those (see example below). You can also drop <code>NA</code> easily by setting <code>na.translate = FALSE</code>.</p>
</section>
<section id="manual-adjustments" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="manual-adjustments">Manual adjustments</h3>
<p>One of the most useful tricks is using “manual” scaling functions to explicitly assign colors as you desire. These are functions with the syntax <code>scale_xxx_manual()</code> (e.g.&nbsp;<code>scale_colour_manual()</code> or <code>scale_fill_manual()</code>). Each of the below arguments are demonstrated in the code example below.</p>
<ul>
<li>Assign colors to data values with the <code>values =</code> argument<br>
</li>
<li>Specify a color for <code>NA</code> with <code>na.value =</code><br>
</li>
<li>Change how the values are <em>written</em> in the legend with the <code>labels =</code> argument<br>
</li>
<li>Change the legend title with <code>name =</code></li>
</ul>
<p>Below, we create a bar plot and show how it appears by default, and then with three scales adjusted - the continuous y-axis scale, the discrete x-axis scale, and manual adjustment of the fill (interior bar color).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BASELINE - no scale adjustment</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> outcome, <span class="at">fill =</span> gender))<span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Baseline - no scale adjustments"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SCALES ADJUSTED</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> outcome, <span class="at">fill =</span> gender), <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                   <span class="co"># simplify background</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(                <span class="co"># continuous scale for y-axis (counts)</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),                 <span class="co"># no padding</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">to =</span> <span class="dv">3000</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="dv">500</span>))<span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(                   <span class="co"># discrete scale for x-axis (gender)</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),                  <span class="co"># no padding</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">drop =</span> <span class="cn">FALSE</span>,                     <span class="co"># show all factor levels (even if not in data)</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.translate =</span> <span class="cn">FALSE</span>,             <span class="co"># remove NA outcomes from plot</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Died"</span>, <span class="st">"Recovered"</span>))<span class="sc">+</span> <span class="co"># Change display of values</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(                  <span class="co"># Manually specify fill (bar interior color)</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"m"</span> <span class="ot">=</span> <span class="st">"violetred"</span>,     <span class="co"># reference values in data to assign colors</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>               <span class="st">"f"</span> <span class="ot">=</span> <span class="st">"aquamarine"</span>),</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"m"</span> <span class="ot">=</span> <span class="st">"Male"</span>,          <span class="co"># re-label the legend (use "=" assignment to avoid mistakes)</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">"f"</span> <span class="ot">=</span> <span class="st">"Female"</span>,</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Missing"</span>),</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Gender"</span>,                  <span class="co"># title of legend</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey"</span>                 <span class="co"># assign a color for missing values</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Adjustment of scales"</span>) <span class="co"># Adjust the title of the fill legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-50-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="continuous-axes-scales" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="continuous-axes-scales">Continuous axes scales</h3>
<p>When data are mapping to the plot axes, these too can be adjusted with scales commands. A common example is adjusting the display of an axis (e.g.&nbsp;y-axis) that is mapped to a column with continuous data.</p>
<p>We may want to adjust the breaks or display of the values in the ggplot using <code>scale_y_continuous()</code>. As noted above, use the argument <code>breaks =</code> to provide a sequence of values that will serve as “breaks” along the scale. These are the values at which numbers will display. To this argument, you can provide a <code>c()</code> vector containing the desired break values, or you can provide a regular sequence of numbers using the <strong>base</strong> R function <code>seq()</code>. This <code>seq()</code> function accepts <code>to =</code>, <code>from =</code>, and <code>by =</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BASELINE - no scale adjustment</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> outcome, <span class="at">fill =</span> gender))<span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Baseline - no scale adjustments"</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> outcome, <span class="at">fill =</span> gender))<span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">to =</span> <span class="dv">3000</span>,</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="dv">100</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Adjusted y-axis breaks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-51-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
<section id="display-percents" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="display-percents">Display percents</h4>
<p>If your original data values are proportions, you can easily display them as percents with “%” by providing <code>labels = scales::percent</code> in your scales command, as shown below.</p>
<p>While an alternative would be to convert the values to character and add a “%” character to the end, this approach will cause complications because your data will no longer be continuous numeric values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Original y-axis proportions</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>                                   <span class="co"># start with linelist</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span>                       <span class="co"># group data by hospital</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(                                   <span class="co"># create summary columns</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),                                     <span class="co"># total number of rows in group</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">deaths =</span> <span class="fu">sum</span>(outcome <span class="sc">==</span> <span class="st">"Death"</span>, <span class="at">na.rm=</span>T),   <span class="co"># number of deaths in group</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_death =</span> deaths<span class="sc">/</span>n) <span class="sc">%&gt;%</span>                   <span class="co"># proportion deaths in group</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(                                      <span class="co"># begin plotting</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> hospital,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> prop_death))<span class="sc">+</span> </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()<span class="sc">+</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Display y-axis original proportions"</span>)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display y-axis proportions as percents</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="do">########################################</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>         </span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">deaths =</span> <span class="fu">sum</span>(outcome <span class="sc">==</span> <span class="st">"Death"</span>, <span class="at">na.rm=</span>T),</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_death =</span> deaths<span class="sc">/</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> hospital,</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> prop_death))<span class="sc">+</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()<span class="sc">+</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Display y-axis as percents (%)"</span>)<span class="sc">+</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span>percent                    <span class="co"># display proportions as percents</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-52-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
<section id="log-scale" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="log-scale">Log scale</h4>
<p>To transform a continuous axis to log scale, add <code>trans = "log2"</code> to the scale command. For purposes of example, we create a data frame of regions with their respective <code>preparedness_index</code> and cumulative cases values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">region =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span>, <span class="st">"I"</span>),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">preparedness_index =</span> <span class="fu">c</span>(<span class="fl">8.8</span>, <span class="fl">7.5</span>, <span class="fl">3.4</span>, <span class="fl">3.6</span>, <span class="fl">2.1</span>, <span class="fl">7.9</span>, <span class="fl">7.0</span>, <span class="fl">5.6</span>, <span class="fl">1.0</span>),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cases_cumulative =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">45</span>, <span class="dv">80</span>, <span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">7</span>, <span class="dv">51</span>, <span class="dv">30</span>, <span class="dv">1442</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>plot_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  region preparedness_index cases_cumulative
1      A                8.8               15
2      B                7.5               45
3      C                3.4               80
4      D                3.6               20
5      E                2.1               21
6      F                7.9                7
7      G                7.0               51
8      H                5.6               30
9      I                1.0             1442</code></pre>
</div>
</div>
<p>The cumulative cases for region “I” are dramatically greater than all the other regions. In circumstances like this, you may elect to display the y-axis using a log scale so the reader can see differences between the regions with fewer cumulative cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Original y-axis</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>preparedness_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> plot_data,  </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> preparedness_index,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> cases_cumulative))<span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span>            <span class="co"># points for each region </span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> region),</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.5</span>)<span class="sc">+</span>                  <span class="co"># add text labels</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>preparedness_plot                  <span class="co"># print original plot</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print with y-axis transformed</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>preparedness_plot<span class="sc">+</span>                   <span class="co"># begin with plot saved above</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">"log2"</span>) <span class="co"># add transformation for y-axis</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-54-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
</section>
<section id="gradient-scales" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="gradient-scales">Gradient scales</h3>
<p>Fill gradient scales can involve additional nuance. The defaults are usually quite pleasing, but you may want to adjust the values, cutoffs, etc.</p>
<p>To demonstrate how to adjust a continuous color scale, we’ll use a data set that contains the ages of cases and of sources in a contact tracing case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>case_source_relationships <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"data/godata/relationships_clean.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(source_age, target_age) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below, we produce a “raster” heat tile density plot. Note how the <code>fill</code> scale is <em>continuous</em>.</p>
<div class="cell" data-warn="false">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>trans_matrix <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> case_source_relationships,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> source_age, <span class="at">y =</span> target_age))<span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density2d</span>(</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"raster"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_stat</span>(density)),</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">contour =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we show some variations on the fill scale:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>trans_matrix</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>trans_matrix <span class="sc">+</span> <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-57-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
<p>Now we show some examples of actually adjusting the break points of the scale:</p>
<ul>
<li><code>scale_fill_gradient()</code> accepts two colors (high/low)<br>
</li>
<li><code>scale_fill_gradientn()</code> accepts a vector of any length of colors to <code>values =</code> (intermediate values will be interpolated)<br>
</li>
<li>Use <a href="https://www.rdocumentation.org/packages/scales/versions/0.4.1/topics/rescale"><code>scales::rescale()</code></a> to adjust how colors are positioned along the gradient; it rescales your vector of positions to be between 0 and 1.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>trans_matrix <span class="sc">+</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(     <span class="co"># 2-sided gradient scale</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"aquamarine"</span>,    <span class="co"># low value</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"purple"</span>,       <span class="co"># high value</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.value =</span> <span class="st">"grey"</span>,     <span class="co"># value for NA</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Density"</span>)<span class="sc">+</span>     <span class="co"># Legend title</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Manually specify high/low colors"</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3+ colors to scale</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>trans_matrix <span class="sc">+</span> </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(    <span class="co"># 3-color scale (low/mid/high)</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span>) <span class="co"># provide colors in vector</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"3-color scale"</span>)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Use of rescale() to adjust placement of colors along scale</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>trans_matrix <span class="sc">+</span> </span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(    <span class="co"># provide any number of colors</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span>, <span class="st">"black"</span>),</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.07</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>)) <span class="co"># positions for colors are rescaled between 0 and 1</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Colors not evenly positioned"</span>)</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="co"># use of limits to cut-off values that get fill color</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>trans_matrix <span class="sc">+</span> </span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(    </span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span>),</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.0002</span>))<span class="sc">+</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Restrict value limits, resulting in grey space"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-58-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-58-3.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-58-4.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
<section id="palettes" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="palettes">Palettes</h3>
<section id="colorbrewer-and-viridis" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="colorbrewer-and-viridis">Colorbrewer and Viridis</h4>
<p>More generally, if you want predefined palettes, you can use the <code>scale_xxx_brewer</code> or <code>scale_xxx_viridis_y</code> functions.</p>
<p>The ‘brewer’ functions can draw from <a href="colorbrewer.org">colorbrewer.org</a> palettes.</p>
<p>The ‘viridis’ functions draw from viridis (colourblind friendly!) palettes, which “provide colour maps that are perceptually uniform in both colour and black-and-white. They are also designed to be perceived by viewers with common forms of colour blindness.” (read more <a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">here</a> and <a href="https://bids.github.io/colormap/">here</a>). Define if the palette is discrete, continuous, or binned by specifying this at the end of the function (e.g.&nbsp;discrete is <code>scale_xxx_viridis_d</code>).</p>
<p>It is advised that you test your plot in this <a href="https://www.color-blindness.com/coblis-color-blindness-simulator/">color blindness simulator</a>. If you have a red/green color scheme, try a “hot-cold” (red-blue) scheme instead as described <a href="https://www.visualisingdata.com/2019/08/five-ways-to-design-for-red-green-colour-blindness/#:~:text=The%20pink%2Dred%20through%20to,green%20hues%20used%20by%20default.">here</a></p>
<p>Here is an example of using various color schemes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>symp_plot <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                                         <span class="co"># begin with linelist</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(case_id, fever, chills, cough, aches, vomit)) <span class="sc">%&gt;%</span>     <span class="co"># select columns</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(                                                  <span class="co"># pivot longer</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>case_id,                                  </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"symptom_name"</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"symptom_is_present"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(                                                        <span class="co"># replace missing values</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">symptom_is_present =</span> <span class="fu">replace_na</span>(symptom_is_present, <span class="st">"unknown"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(                                                        <span class="co"># begin ggplot!</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> symptom_name, <span class="at">fill =</span> symptom_is_present))<span class="sc">+</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span>                    </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)<span class="sc">+</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Symptom"</span>,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Symptom status (proportion)"</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>symp_plot  <span class="co"># print with default colors</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="do">#################################</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print with manually-specified colors</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>symp_plot <span class="sc">+</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"yes"</span> <span class="ot">=</span> <span class="st">"black"</span>,         <span class="co"># explicitly define colours</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>               <span class="st">"no"</span> <span class="ot">=</span> <span class="st">"white"</span>,</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>               <span class="st">"unknown"</span> <span class="ot">=</span> <span class="st">"grey"</span>),</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="st">"unknown"</span>), <span class="co"># order the factors correctly</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span>                           <span class="co"># set legend to no title</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a><span class="do">#################################</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a><span class="co"># print with viridis discrete colors</span></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>symp_plot <span class="sc">+</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"yes"</span>, <span class="st">"no"</span>, <span class="st">"unknown"</span>),</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-59-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-59-3.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
<!-- ======================================================= -->
</section>
</section>
</section>
<section id="change-order-of-discrete-variables" class="level2">
<h2 class="anchored" data-anchor-id="change-order-of-discrete-variables">Change order of discrete variables</h2>
<p>Changing the order that discrete variables appear in is often difficult to understand for people who are new to <code>ggplot2</code> graphs. It’s easy to understand how to do this however once you understand how <code>ggplot2</code> handles discrete variables under the hood. Generally speaking, if a discrete varaible is used, it is automatically converted to a <code>factor</code> type - which orders factors by alphabetical order by default. To handle this, you simply have to reorder the factor levels to reflect the order you would like them to appear in the chart. For more detailed information on how to reorder <code>factor</code> objects, see the factor section of the guide.</p>
<p>We can look at a common example using age groups - by default the 5-9 age group will be placed in the middle of the age groups (given alphanumeric order), but we can move it behind the 0-4 age group of the chart by releveling the factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(age_cat5),                         <span class="co"># remove rows where age_cat5 is missing</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_relevel</span>(age_cat5, <span class="st">"5-9"</span>, <span class="at">after =</span> <span class="dv">1</span>))) <span class="sc">+</span>  <span class="co"># relevel factor</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age group"</span>, <span class="at">y =</span> <span class="st">"Number of hospitalisations"</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total hospitalisations by age group"</span>) <span class="sc">+</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="advanced-ggplot-optional" class="level2">
<h2 class="anchored" data-anchor-id="advanced-ggplot-optional">Advanced ggplot (optional)</h2>
<p>These are a collection of less common plot types, ggplot2 extensions, and advanced examples of some of the things you can do visualizing data in R.</p>
<section id="contour-lines" class="level3">
<h3 class="anchored" data-anchor-id="contour-lines">Contour lines</h3>
<p>Contour plots are helpful when you have many points that might cover each other (“overplotting”). The case-source data used above are again plotted, but more simply using <code>stat_density2d()</code> and <code>stat_density2d_filled()</code> to produce discrete contour levels - like a topographical map. Read more about the statistics <a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>case_source_relationships <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> source_age, <span class="at">y =</span> target_age))<span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density2d</span>()<span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"stat_density2d() + geom_point()"</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>case_source_relationships <span class="sc">%&gt;%</span> </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> source_age, <span class="at">y =</span> target_age))<span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density2d_filled</span>()<span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"stat_density2d_filled()"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" style="width:50.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-61-2.png" class="img-fluid" style="width:50.0%"></p>
</div>
</div>
</section>
<section id="marginal-distributions" class="level3">
<h3 class="anchored" data-anchor-id="marginal-distributions">Marginal distributions</h3>
<p>To show the distributions on the edges of a <code>geom_point()</code> scatterplot, you can use the <strong>ggExtra</strong> package and its function <code>ggMarginal()</code>. Save your original ggplot as an object, then pass it to <code>ggMarginal()</code> as shown below. Here are the key arguments:</p>
<ul>
<li>You must specify the <code>type =</code> as either “histogram”, “density” “boxplot”, “violin”, or “densigram”.<br>
</li>
<li>By default, marginal plots will appear for both axes. You can set <code>margins =</code> to “x” or “y” if you only want one.<br>
</li>
<li>Other optional arguments include <code>fill =</code> (bar color), <code>color =</code> (line color), <code>size =</code> (plot size relative to margin size, so larger number makes the marginal plot smaller).<br>
</li>
<li>You can provide other axis-specific arguments to <code>xparams =</code> and <code>yparams =</code>. For example, to have different histogram bin sizes, as shown below.</li>
</ul>
<p>You can have the marginal plots reflect groups (columns that have been assigned to <code>color =</code> in your <code>ggplot()</code> mapped aesthetics). If this is the case, set the <code>ggMarginal()</code> argument <code>groupColour =</code> or <code>groupFill =</code> to <code>TRUE</code>, as shown below.</p>
<p>Read more at <a href="https://cran.r-project.org/web/packages/ggExtra/vignettes/ggExtra.html">this vignette</a>, in the <a href="https://www.r-graph-gallery.com/277-marginal-histogram-for-ggplot2.html">R Graph Gallery</a> or the function R documentation <code>?ggMarginal</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install/load ggExtra</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggExtra)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic scatter plot of weight and age</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>scatter_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> wt_kg, <span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Scatter plot of weight and age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To add marginal histograms use <code>type = "histogram"</code>. You can optionally set <code>groupFill = TRUE</code> to get stacked histograms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with histograms</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  scatter_plot,                     <span class="co"># add marginal histograms</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"histogram"</span>,               <span class="co"># specify histograms</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">"lightblue"</span>,               <span class="co"># bar fill</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="dv">10</span>),    <span class="co"># other parameters for x-axis marginal</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">yparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="dv">5</span>))     <span class="co"># other parameters for y-axis marginal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Marginal density plot with grouped/colored values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot, colored by outcome</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Outcome column is assigned as color in ggplot. groupFill in ggMarginal set to TRUE</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>scatter_plot_color <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(gender))<span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> wt_kg, <span class="at">x =</span> age, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Scatter plot of weight and age"</span>)<span class="sc">+</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(scatter_plot_color, <span class="at">type =</span> <span class="st">"density"</span>, <span class="at">groupFill =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Set the <code>size =</code> arguemnt to adjust the relative size of the marginal plot. Smaller number makes a larger marginal plot. You also set <code>color =</code>. Below are is a marginal boxplot, with demonstration of the <code>margins =</code> argument so it appears on only one axis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with boxplot </span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggMarginal</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  scatter_plot,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">margins =</span> <span class="st">"x"</span>,      <span class="co"># only show x-axis marginal plot</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"boxplot"</span>)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- ======================================================= -->
</section>
<section id="smart-labeling" class="level3">
<h3 class="anchored" data-anchor-id="smart-labeling">Smart Labeling</h3>
<p>In <strong>ggplot2</strong>, it is also possible to add text to plots. However, this comes with the notable limitation where text labels often clash with data points in a plot, making them look messy or hard to read. There is no ideal way to deal with this in the base package, but there is a <strong>ggplot2</strong> add-on, known as <strong>ggrepel</strong> that makes dealing with this very simple!</p>
<p>The <strong>ggrepel</strong> package provides two new functions, <code>geom_label_repel()</code> and <code>geom_text_repel()</code>, which replace <code>geom_label()</code> and <code>geom_text()</code>. Simply use these functions instead of the base functions to produce neat labels. Within the function, map the aesthetics <code>aes()</code> as always, but include the argument <code>label =</code> to which you provide a column name containing the values you want to display (e.g.&nbsp;patient id, or name, etc.). You can make more complex labels by combining columns and newlines (<code>\n</code>) within <code>str_glue()</code> as shown below.</p>
<p>A few tips:</p>
<ul>
<li>Use <code>min.segment.length = 0</code> to always draw line segments, or <code>min.segment.length = Inf</code> to never draw them<br>
</li>
<li>Use <code>size =</code> outside of <code>aes()</code> to set text size<br>
</li>
<li>Use <code>force =</code> to change the degree of repulsion between labels and their respective points (default is 1)<br>
</li>
<li>Include <code>fill =</code> within <code>aes()</code> to have label colored by value
<ul>
<li>A letter “a” may appear in the legend - add <code>guides(fill = guide_legend(override.aes = aes(color = NA)))+</code> to remove it</li>
</ul></li>
</ul>
<p>See this is very in-depth <a href="https://ggrepel.slowkow.com/articles/examples.html">tutorial</a> for more.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(ggrepel)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>                                               <span class="co"># start with linelist</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span>                                   <span class="co"># group by hospital</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(                                               <span class="co"># create new dataset with summary values per hospital</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cases =</span> <span class="fu">n</span>(),                                           <span class="co"># number of cases per hospital</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay_mean =</span> <span class="fu">round</span>(<span class="fu">mean</span>(days_onset_hosp, <span class="at">na.rm=</span>T),<span class="dv">1</span>),    <span class="co"># mean delay per hospital</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> n_cases, <span class="at">y =</span> delay_mean))<span class="sc">+</span>      <span class="co"># send data frame to ggplot</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span>                                    <span class="co"># add points</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(                                        <span class="co"># add point labels</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"{hospital}</span><span class="sc">\n</span><span class="st">{n_cases} cases, {delay_mean} days"</span>)  <span class="co"># how label displays</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>      ), </span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,                                              <span class="co"># text size in labels</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.segment.length =</span> <span class="dv">0</span>)<span class="sc">+</span>                               <span class="co"># show all line segments                </span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(                                                    <span class="co"># add axes labels</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean delay to admission, by hospital"</span>,</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of cases"</span>,</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Mean delay (days)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can label only a subset of the data points - by using standard <code>ggplot()</code> syntax to provide different <code>data =</code> for each <code>geom</code> layer of the plot. Below, All cases are plotted, but only a few are labeled.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># All points in grey</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> linelist,                                   <span class="co"># all data provided to this layer</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ht_cm, <span class="at">y =</span> wt_kg),</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span>                                              <span class="co"># grey and semi-transparent</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Few points in black</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(days_onset_hosp <span class="sc">&gt;</span> <span class="dv">15</span>),  <span class="co"># filtered data provided to this layer</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ht_cm, <span class="at">y =</span> wt_kg),</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>)<span class="sc">+</span>                                                <span class="co"># default black and not transparent</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># point labels for few points</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(days_onset_hosp <span class="sc">&gt;</span> <span class="dv">15</span>),  <span class="co"># filter the data for the labels</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> ht_cm,</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> wt_kg,</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> outcome,                                          <span class="co"># label color by outcome</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">"Delay: {days_onset_hosp}d"</span>)), <span class="co"># label created with str_glue()</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.segment.length =</span> <span class="dv">0</span>) <span class="sc">+</span>                                  <span class="co"># show line segments for all</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove letter "a" from inside legend boxes</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">aes</span>(<span class="at">color =</span> <span class="cn">NA</span>)))<span class="sc">+</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># axis labels</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cases with long delay to admission"</span>,</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"weight (kg)"</span>,</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"height(cm)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- ======================================================= -->
</section>
<section id="highlighting" class="level3">
<h3 class="anchored" data-anchor-id="highlighting">Highlighting</h3>
<p>Highlighting specific elements in a chart is a useful way to draw attention to a specific instance of a variable while also providing information on the dispersion of the full dataset. While this is not easily done in base <strong>ggplot2</strong>, there is an external package that can help to do this known as <strong>gghighlight</strong>. This is easy to use within the ggplot syntax.</p>
<p>The <strong>gghighlight</strong> package uses the <code>gghighlight()</code> function to achieve this effect. To use this function, supply a logical statement to the function - this can have quite flexible outcomes, but here we’ll show an example of the age distribution of cases in our linelist, highlighting them by outcome.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load gghighlight</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># replace NA values with unknown in the outcome variable</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">replace_na</span>(outcome, <span class="st">"Unknown"</span>))</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co"># produce a histogram of all cases by age</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> linelist,</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age_years, <span class="at">fill =</span> outcome)) <span class="sc">+</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  gghighlight<span class="sc">::</span><span class="fu">gghighlight</span>(outcome <span class="sc">==</span> <span class="st">"Death"</span>)     <span class="co"># highlight instances where the patient has died.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This also works well with faceting functions - it allows the user to produce facet plots with the background data highlighted that doesn’t apply to the facet! Below we count cases by week and plot the epidemic curves by hospital (<code>color =</code> and <code>facet_wrap()</code> set to <code>hospital</code> column).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># produce a histogram of all cases by age</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">week =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(date_hospitalisation, <span class="st">"week"</span>),</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>        hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> n, <span class="at">color =</span> hospital))<span class="sc">+</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  gghighlight<span class="sc">::</span><span class="fu">gghighlight</span>() <span class="sc">+</span>                      <span class="co"># highlight instances where the patient has died</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hospital)                              <span class="co"># make facets by outcome</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="plotting-multiple-datasets" class="level3">
<h3 class="anchored" data-anchor-id="plotting-multiple-datasets">Plotting multiple datasets</h3>
<p>Note that properly aligning axes to plot from multiple datasets in the same plot can be difficult. Consider one of the following strategies:</p>
<ul>
<li>Merge the data prior to plotting, and convert to “long” format with a column reflecting the dataset<br>
</li>
<li>Use <strong>cowplot</strong> or a similar package to combine two plots (see below)</li>
</ul>
<!-- ======================================================= -->
</section>
<section id="combine-plots" class="level3">
<h3 class="anchored" data-anchor-id="combine-plots">Combine plots</h3>
<p>Two packages that are very useful for combining plots are <strong>cowplot</strong> and <strong>patchwork</strong>. In this page we will mostly focus on <strong>cowplot</strong>, with occassional use of <strong>patchwork</strong>.</p>
<p>Here is the online <a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html">introduction to cowplot</a>. You can read the more extensive documentation for each function online <a href="https://www.rdocumentation.org/packages/cowplot/versions/1.1.1">here</a>. We will cover a few of the most common use cases and functions below.</p>
<p>The <strong>cowplot</strong> package works in tandem with <strong>ggplot2</strong> - essentially, you use it to arrange and combine ggplots and their legends into compound figures. It can also accept <strong>base</strong> R graphics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  tidyverse,      <span class="co"># data manipulation and visualisation</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  cowplot,        <span class="co"># combine plots</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  patchwork       <span class="co"># combine plots</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While faceting is a convenient approach to plotting, sometimes its not possible to get the results you want from its relatively restrictive approach. Here, you may choose to combine plots by sticking them together into a larger plot. There are three well known packages that are great for this - <strong>cowplot</strong>, <strong>gridExtra</strong>, and <strong>patchwork</strong>. However, these packages largely do the same things, so we’ll focus on <strong>cowplot</strong> for this section.</p>
<section id="plot_grid" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="plot_grid"><code>plot_grid()</code></h4>
<p>The <strong>cowplot</strong> package has a fairly wide range of functions, but the easiest use of it can be achieved through the use of <code>plot_grid()</code>. This is effectively a way to arrange predefined plots in a grid formation. We can work through another example with the malaria dataset - here we can plot the total cases by district, and also show the epidemic curve over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>malaria_data <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"data/malaria_facility_count_data.rds"</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># bar chart of total cases by district</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> District, <span class="at">y =</span> malaria_tot)) <span class="sc">+</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"District"</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total number of cases"</span>,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Total malaria cases by district"</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># epidemic curve over time</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(malaria_data, <span class="fu">aes</span>(<span class="at">x =</span> data_date, <span class="at">y =</span> malaria_tot)) <span class="sc">+</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date of data submission"</span>,</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span>  <span class="st">"number of cases"</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2,</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># 1 column and two rows - stacked on top of each other</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>                   <span class="co"># top plot is 2/3 as tall as second</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="combine-legends" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="combine-legends">Combine legends</h4>
<p>If your plots have the same legend, combining them is relatively straight-forward. Simple use the <strong>cowplot</strong> approach above to combine the plots, but remove the legend from one of them (de-duplicate).</p>
<p>If your plots have different legends, you must use an alternative approach:</p>
<ol type="1">
<li>Create and save your plots <em>without legends</em> using <code>theme(legend.position = "none")</code><br>
</li>
<li>Extract the legends from each plot using <code>get_legend()</code> as shown below - <em>but extract legends from the plots modified to actually show the legend</em><br>
</li>
<li>Combine the legends into a legends panel<br>
</li>
<li>Combine the plots and legends panel</li>
</ol>
<p>For demonstration we show the two plots separately, and then arranged in a grid with their own legends showing (ugly and inefficient use of space):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="ot">=</span> <span class="st">"St. Marks"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hospital, outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospital, <span class="at">y =</span> n, <span class="at">fill =</span> outcome))<span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, <span class="at">palette =</span> <span class="dv">4</span>, <span class="at">na.value =</span> <span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cases by outcome"</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="ot">=</span> <span class="st">"St. Marks"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hospital, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospital, <span class="at">y =</span> n, <span class="at">fill =</span> age_cat))<span class="sc">+</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, <span class="at">palette =</span> <span class="dv">1</span>, <span class="at">na.value =</span> <span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cases by age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is how the two plots look when combined using <code>plot_grid()</code> without combining their legends:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And now we show how to combine the legends. Essentially what we do is to define each plot <em>without</em> its legend (<code>theme(legend.position = "none"</code>), and then we define each plot’s legend <em>separately</em>, using the <code>get_legend()</code> function from <strong>cowplot</strong>. When we extract the legend from the saved plot, we need to add <code>+</code> the legend back in, including specifying the placement (“right”) and smaller adjustments for alignment of the legends and their titles. Then, we combine the legends together vertically, and then combine the two plots with the newly-combined legends. Voila!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plot 1 without legend</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="ot">=</span> <span class="st">"St. Marks"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hospital, outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospital, <span class="at">y =</span> n, <span class="at">fill =</span> outcome))<span class="sc">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, <span class="at">palette =</span> <span class="dv">4</span>, <span class="at">na.value =</span> <span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cases by outcome"</span>)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plot 2 without legend</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="ot">=</span> <span class="st">"St. Marks"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hospital, age_cat) <span class="sc">%&gt;%</span> </span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospital, <span class="at">y =</span> n, <span class="at">fill =</span> age_cat))<span class="sc">+</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, <span class="at">palette =</span> <span class="dv">1</span>, <span class="at">na.value =</span> <span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cases by age"</span>)</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a><span class="co"># extract legend from p1 (from p1 + legend)</span></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>leg_p1 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">get_legend</span>(p1 <span class="sc">+</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,        <span class="co"># extract vertical legend</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>))<span class="sc">+</span> <span class="co"># so legends  align</span></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Outcome"</span>))                 <span class="co"># title of legend</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a><span class="co"># extract legend from p2 (from p2 + legend)</span></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>leg_p2 <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">get_legend</span>(p2 <span class="sc">+</span> </span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,         <span class="co"># extract vertical legend   </span></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>))<span class="sc">+</span>  <span class="co"># so legends align</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Age Category"</span>))             <span class="co"># title of legend</span></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a><span class="co"># create a blank plot for legend alignment</span></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a><span class="co">#blank_p &lt;- patchwork::plot_spacer() + theme_void()</span></span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a><span class="co"># create legends panel, can be one on top of the other (or use spacer commented above)</span></span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>legends <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(leg_p1, leg_p2, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">rel_heights =</span> <span class="fu">c</span>(.<span class="dv">3</span>, .<span class="dv">7</span>))</span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a><span class="co"># combine two plots and the combined legends panel</span></span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2, legends, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(.<span class="dv">4</span>, .<span class="dv">4</span>, .<span class="dv">2</span>))</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a>combined  <span class="co"># print</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This solution was learned from <a href="https://stackoverflow.com/questions/52060601/ggplot-multiple-legends-arrangement">this post</a> with a minor fix to align legends from <a href="https://github.com/wilkelab/cowplot/issues/33">this post</a>.</p>
<p><span style="color: darkgreen;"><strong><em>TIP:</em></strong> Fun note - the “cow” in <strong>cowplot</strong> comes from the creator’s name - Claus O. Wilke.</span></p>
</section>
<section id="inset-plots" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="inset-plots">Inset plots</h4>
<p>You can inset one plot in another using <strong>cowplot</strong>. Here are things to be aware of:</p>
<ul>
<li>Define the main plot with <code>theme_half_open()</code> from <strong>cowplot</strong>; it may be best to have the legend either on top or bottom<br>
</li>
<li>Define the inset plot. Best is to have a plot where you do not need a legend. You can remove plot theme elements with <code>element_blank()</code> as shown below.<br>
</li>
<li>Combine them by applying <code>ggdraw()</code> to the main plot, then adding <code>draw_plot()</code> on the inset plot and specifying the coordinates (x and y of lower left corner), height and width as proportion of the whole main plot.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define main plot</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>main_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_onset, <span class="at">fill =</span> hospital))<span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, <span class="at">palette =</span> <span class="dv">1</span>, <span class="at">na.value =</span> <span class="st">"grey"</span>)<span class="sc">+</span> </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_half_open</span>()<span class="sc">+</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)<span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Epidemic curve and outcomes by hospital"</span>)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define inset plot</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>inset_plot <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital, <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="ot">=</span> <span class="st">"St. Marks"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(hospital, outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospital, <span class="at">y =</span> n, <span class="at">fill =</span> outcome))<span class="sc">+</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">"qual"</span>, <span class="at">palette =</span> <span class="dv">4</span>, <span class="at">na.value =</span> <span class="st">"grey"</span>)<span class="sc">+</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cases by outcome"</span>) </span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine main with inset</span></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">ggdraw</span>(main_plot)<span class="sc">+</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>     <span class="fu">draw_plot</span>(inset_plot,</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> .<span class="dv">6</span>, <span class="at">y =</span> .<span class="dv">55</span>,    <span class="co">#x = .07, y = .65,</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> .<span class="dv">4</span>, <span class="at">height =</span> .<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot-basics_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>This technique is explained more in these two vignettes:</p>
<p><a href="https://wilkelab.org/cowplot/articles/drawing_with_on_plots.html">Wilke lab</a><br>
<a href="https://www.rdocumentation.org/packages/cowplot/versions/1.1.1/topics/draw_plot">draw_plot() documentation</a></p>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>