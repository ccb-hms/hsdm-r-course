<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Research Design and Analysis - Week 6: Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Research Design and Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../readings/readings.html" rel="" target="">
 <span class="menu-text">Readings</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../session-materials/sessions.html" rel="" target="" aria-current="page">
 <span class="menu-text">In-Class Materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../exercises/exercises.html" rel="" target="">
 <span class="menu-text">Exercises</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources/resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../session-materials/session6/session6.html">Week 6: Regression</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../session-materials/sessions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sessions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../session-materials/session0/bootcamp-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootcamp Part 1: R Basics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../session-materials/session0/bootcamp-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootcamp Part 2: Starting with Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../session-materials/session2/session2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 2: Markdown and introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../session-materials/session3/session3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3: Plotting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../session-materials/session4/session4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4: Preparing Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../session-materials/session5/session5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5: Exploratory analysis and basic tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../session-materials/session6/session6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Week 6: Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../session-materials/session7/session7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 7: Advanced Regression</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#causal-relationships" id="toc-causal-relationships" class="nav-link" data-scroll-target="#causal-relationships">Causal Relationships</a></li>
  <li><a href="#correlation-vs.-causation" id="toc-correlation-vs.-causation" class="nav-link" data-scroll-target="#correlation-vs.-causation">Correlation vs.&nbsp;Causation</a></li>
  <li><a href="#causation" id="toc-causation" class="nav-link" data-scroll-target="#causation">Causation</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a></li>
  <li><a href="#plot-the-data" id="toc-plot-the-data" class="nav-link" data-scroll-target="#plot-the-data">Plot the data</a></li>
  <li><a href="#linear-regression-1" id="toc-linear-regression-1" class="nav-link" data-scroll-target="#linear-regression-1">Linear Regression</a></li>
  <li><a href="#least-squares" id="toc-least-squares" class="nav-link" data-scroll-target="#least-squares">Least Squares</a></li>
  <li><a href="#simulation-experiments" id="toc-simulation-experiments" class="nav-link" data-scroll-target="#simulation-experiments">Simulation Experiments</a></li>
  <li><a href="#repeating-simulations" id="toc-repeating-simulations" class="nav-link" data-scroll-target="#repeating-simulations">Repeating simulations</a></li>
  <li><a href="#inference-about-the-model" id="toc-inference-about-the-model" class="nav-link" data-scroll-target="#inference-about-the-model">Inference about the model</a></li>
  <li><a href="#anscombes-quartet" id="toc-anscombes-quartet" class="nav-link" data-scroll-target="#anscombes-quartet">Anscombe’s Quartet</a></li>
  <li><a href="#evaluating-models" id="toc-evaluating-models" class="nav-link" data-scroll-target="#evaluating-models">Evaluating Models</a>
  <ul class="collapse">
  <li><a href="#residual-plots" id="toc-residual-plots" class="nav-link" data-scroll-target="#residual-plots">Residual Plots</a></li>
  </ul></li>
  <li><a href="#extensions---non-linear-models" id="toc-extensions---non-linear-models" class="nav-link" data-scroll-target="#extensions---non-linear-models">Extensions - non-linear models</a></li>
  <li><a href="#prediction-and-prediction-intervals" id="toc-prediction-and-prediction-intervals" class="nav-link" data-scroll-target="#prediction-and-prediction-intervals">Prediction and Prediction intervals</a>
  <ul class="collapse">
  <li><a href="#example-confidence-interval-vs-prediction-interval" id="toc-example-confidence-interval-vs-prediction-interval" class="nav-link" data-scroll-target="#example-confidence-interval-vs-prediction-interval">Example: Confidence Interval vs Prediction Interval</a></li>
  </ul></li>
  <li><a href="#regressions-using-factors" id="toc-regressions-using-factors" class="nav-link" data-scroll-target="#regressions-using-factors">Regressions using factors</a>
  <ul class="collapse">
  <li><a href="#fitting-factors-in-regression-models" id="toc-fitting-factors-in-regression-models" class="nav-link" data-scroll-target="#fitting-factors-in-regression-models">Fitting factors in regression models</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 6: Regression</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 data-anchor-id="introduction">Introduction</h2>
<p>Regression analysis comes in many forms. Here we will learn about linear regression. Regression is a set of tools that allow you to model and interpret the relationships between two or more variables. In regression we treat on variable as the response and a set of variables as possible predictors of the response. Regression models can be used for prediction, for explanation, to test hypotheses about relationships between variables</p>
</section>
<section id="causal-relationships" class="level2">
<h2 data-anchor-id="causal-relationships">Causal Relationships</h2>
<p>Let’s look at some data from 1989 on infant death rates per 1000 of population. <code>read.table</code> is a more general form of <code>read.csv</code> which can more easily handle non-standard table formats, here the data is separated by tabs as opposed to commas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>infdeath <span class="ot">=</span> <span class="fu">read.table</span>( <span class="st">"infdeath.txt"</span>, <span class="at">head=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(infdeath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20  4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(infdeath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "country" "safe"    "breast"  "death"  </code></pre>
</div>
</div>
<p>We have 20 measurements on - <code>safe</code>=access to safe water - <code>breast</code>= percentage of mothers breast feeding at 6 months - <code>death</code> = infant death rate</p>
</section>
<section id="correlation-vs.-causation" class="level2">
<h2 data-anchor-id="correlation-vs.-causation">Correlation vs.&nbsp;Causation</h2>
<p>When performing any time of analysis where we look at the relationship between two variables, we need to be careful to not mix up correlation and causation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(infdeath<span class="sc">$</span>breast, infdeath<span class="sc">$</span>death, <span class="at">xlab=</span><span class="st">"% Breast Feeding"</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Infant Death Rate"</span>, <span class="at">pty=</span><span class="st">"s"</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">cex.axis=</span><span class="fl">1.5</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="session6_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Looking at this data naively, it suggests that longer time breast feeding leads to greater infant mortality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(infdeath<span class="sc">$</span>safe, infdeath<span class="sc">$</span>breast, <span class="at">ylab=</span><span class="st">"% Breast Feeding"</span>, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"% Access to safe water"</span>, <span class="at">pty=</span><span class="st">"s"</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">cex.axis=</span><span class="fl">1.5</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="session6_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, there is a <strong>latent variable</strong> which is actually influencing our result. Countries with access to safe water breast feed for less time.</p>
</section>
<section id="causation" class="level2">
<h2 data-anchor-id="causation">Causation</h2>
<p>Often, as in the example above, there is a third variable (access to clean water) that affects both the response and the predictor. To truly get at causation we typically need a randomized controlled experiment However, we cannot always do experiments, e.g.&nbsp;most epidemiology.</p>
</section>
<section id="linear-regression" class="level2 smaller">
<h2 class="smaller" data-anchor-id="linear-regression">Linear Regression</h2>
<p>In linear regression we want to relate the response, <span class="math inline">\(y\)</span> to the predictor <span class="math inline">\(x\)</span> using a straight line model</p>
<pre><code>$y = \beta_0 + \beta_1 \cdot x + \epsilon$</code></pre>
<p>You may be more familiar with the notation <span class="math inline">\(y = mx + b\)</span>, which is the identical equation using different variable names.</p>
<p>In this model:</p>
<ul>
<li><p><span class="math inline">\(\beta_0\)</span> is the intercept - the value that <span class="math inline">\(y\)</span> takes when <span class="math inline">\(x=0\)</span></p></li>
<li><p><span class="math inline">\(\beta_1\)</span> is the slope of the line, relating <span class="math inline">\(x\)</span> to <span class="math inline">\(y\)</span> and can be interpreted as the average change in <span class="math inline">\(y\)</span> for a one unit change in <span class="math inline">\(x\)</span></p></li>
<li><p><span class="math inline">\(\epsilon\)</span> represents the inherent variability in the system, it is assumed to be zero on average</p></li>
</ul>
<p>Some of the statistical theory is easier if you assume that <span class="math inline">\(\epsilon\)</span>’s come as independent observations with the same distribution (<em>i</em>.<em>i</em>.<em>d</em>), but this is not essential.</p>
</section>
<section id="plot-the-data" class="level2">
<h2 data-anchor-id="plot-the-data">Plot the data</h2>
<p>We can use the <code>lm</code> function in R to create a linear model. We then also use R’s formula notation to tell it what we want the model to describe. Here, we want to examine the relationship between mortality and breastfeeding, which we can specify by giving R the linear model <code>y~x</code>, or here <code>infdeath$death ~ infdeath$breast</code>. Note that we don’t need to tell R that we want the model to have an intercept, it incorporates one automatically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(infdeath<span class="sc">$</span>breast, infdeath<span class="sc">$</span>death, <span class="at">xlab=</span><span class="st">"% Breast Feeding"</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Infant Death Rate"</span>, <span class="at">pty=</span><span class="st">"s"</span>, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">cex.axis=</span><span class="fl">1.5</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab=</span><span class="fl">1.5</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>,<span class="dv">150</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">=</span> <span class="fu">lm</span>(infdeath<span class="sc">$</span>death<span class="sc">~</span>infdeath<span class="sc">$</span>breast)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lm1, <span class="at">col=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="session6_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can directly output the model coefficients and other information, here the learned slope and intercept of the line, by using <code>summary</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = infdeath$death ~ infdeath$breast)

Residuals:
    Min      1Q  Median      3Q     Max 
-37.568 -21.047   1.368  19.479  33.705 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      -26.978     20.148  -1.339 0.205392    
infdeath$breast    1.467      0.288   5.093 0.000265 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 23.86 on 12 degrees of freedom
  (6 observations deleted due to missingness)
Multiple R-squared:  0.6837,    Adjusted R-squared:  0.6573 
F-statistic: 25.94 on 1 and 12 DF,  p-value: 0.000265</code></pre>
</div>
</div>
<p>We can see that the intercept is about -27 and the slope is about 1.5.</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try to interpret these results. What do the slope and intercept mean?</p>
</div>
</div>
</section>
<section id="linear-regression-1" class="level2">
<h2 data-anchor-id="linear-regression-1">Linear Regression</h2>
<p>We denote our estimates by putting a hat on the parameter, e.g.&nbsp;<span class="math inline">\(\hat{\beta_0}\)</span>. This helps make it clear that the coefficients and intercept we found are just estimates based on our data. Ideally, we would want to know the <em>true</em> slope and intercept, but that would be impossible unless we collected data on every infant in the world.</p>
<p>Our estimated line is the given by <span class="math inline">\(\hat{y} = \hat{\beta}_0 + \hat{\beta}_1 \cdot x\)</span>. Now that we have these estimates, given a new <span class="math inline">\(x\)</span> we can then predict <span class="math inline">\(y\)</span>. However, we have to be careful about whether the new <span class="math inline">\(x\)</span> is sensible.</p>
<p>Let’s look under the hood of the linear model. How do we choose the <strong>best</strong> straight line?</p>
</section>
<section id="least-squares" class="level2">
<h2 data-anchor-id="least-squares">Least Squares</h2>
<p>Let our <em>predicted values</em> be <span class="math inline">\(\hat{y}_i = \hat{\beta}_0 + \hat{\beta}_1 \cdot x_i\)</span>, and the real values in our data be denoted as <span class="math inline">\(y_i\)</span>.</p>
<p>One strategy to choose our predicted values is to minimize the sum of squared prediction errors:</p>
<p><span class="math display">\[
\sum_{i=1}^n (y_i - \hat{y}_i)^2
\]</span> This method is called <em>least squares</em> and was described by Gauss in 1822.</p>
<p>Another way to look at our model is as</p>
<p><span class="math display">\[
Y = \beta_0 + \beta_1 \cdot X + \epsilon
\]</span> Where we use <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> to represent the fact that data came from some form of sample from a population we want to make inference about, and <span class="math inline">\(\epsilon\)</span> is the error between each observation and it’s real value based on our model coefficients. Usually we will assume our errors are normally distributed around 0 <span class="math inline">\(\epsilon \sim N(0, \sigma^2)\)</span>, and so are independent (but that is not strictly necessary).</p>
</section>
<section id="simulation-experiments" class="level2">
<h2 data-anchor-id="simulation-experiments">Simulation Experiments</h2>
<p>One tool that you can use to understand how different methods work is to create a simulation experiment. In these experiments you create a model, where you know the answer, and you control the variability or stochastic component. Then, you can interpret the way in which the different quantities you are estimating behave. This can help us understand why we might be getting a particular result, or what would happen if our assumptions were not true.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate some x values</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="at">min=</span><span class="dv">20</span>, <span class="at">max=</span><span class="dv">70</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set our regression</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="dv">5</span> <span class="sc">+</span> .<span class="dv">2</span> <span class="sc">*</span>x </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add in some random error</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>yobs <span class="ot">=</span> y <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">sd=</span><span class="fl">1.5</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a linear model</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">=</span> <span class="fu">lm</span>(yobs<span class="sc">~</span>x)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = yobs ~ x)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.1142 -0.9480 -0.1303  1.0299  2.8389 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  6.71335    1.04242   6.440 4.63e-06 ***
x            0.16055    0.02088   7.691 4.28e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.426 on 18 degrees of freedom
Multiple R-squared:  0.7667,    Adjusted R-squared:  0.7537 
F-statistic: 59.15 on 1 and 18 DF,  p-value: 4.275e-07</code></pre>
</div>
</div>
</section>
<section id="repeating-simulations" class="level2">
<h2 data-anchor-id="repeating-simulations">Repeating simulations</h2>
<p>We often want to run many simulations to see how likely certain results are or explore another facet of the model. Here, we run 1000 simulations like the one above. We repeatedly sample from a Normal distribution with <code>sd=1.5</code> and create a new <span class="math inline">\(y\)</span>. Then, we estimate the parameters for that model, and save them. The code below does this using a for loop. We won’t be covering for loops, but they allow a chunk of code to repeat a certain number of times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, create empty vectors with the number of simulations we want to run. </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>NITER<span class="ot">=</span><span class="dv">1000</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>b0vec <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, NITER)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>b1vec <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, NITER)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create NITER different simulated datasets and linear models using a for loop, storing the results into the vectors we created. </span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>NITER) {</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  ei <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">sd=</span><span class="fl">1.5</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  yoi <span class="ot">=</span> y <span class="sc">+</span> ei</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  lmi <span class="ot">=</span> <span class="fu">lm</span>(yoi <span class="sc">~</span> x)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  b0vec[i] <span class="ot">=</span> lmi<span class="sc">$</span>coefficients[<span class="dv">1</span>]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  b1vec[i] <span class="ot">=</span> lmi<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at the distribution of coefficients produced by our simulations.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="session6_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also see the mean and standard deviation across the simulations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Intercept</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(b0vec), <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.965</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">var</span>(b0vec)), <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.119</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Slope</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(b1vec), <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.201</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">var</span>(b1vec)), <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.023</code></pre>
</div>
</div>
<p>Let’s compare these values to the regression summary from our first simulation. How do the values compare? What can you interpret?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = yobs ~ x)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.1142 -0.9480 -0.1303  1.0299  2.8389 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  6.71335    1.04242   6.440 4.63e-06 ***
x            0.16055    0.02088   7.691 4.28e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.426 on 18 degrees of freedom
Multiple R-squared:  0.7667,    Adjusted R-squared:  0.7537 
F-statistic: 59.15 on 1 and 18 DF,  p-value: 4.275e-07</code></pre>
</div>
</div>
</section>
<section id="inference-about-the-model" class="level2">
<h2 data-anchor-id="inference-about-the-model">Inference about the model</h2>
<p>When interpretting the summary output, we can note that: - Typically the intercept is not that interesting. - We test the hypothesis <span class="math inline">\(H_0: \beta_1 = 0\)</span> to determine whether <span class="math inline">\(x\)</span> provides any explanation of <span class="math inline">\(y\)</span>. - <span class="math inline">\(R^2\)</span> and multiple <span class="math inline">\(R^2\)</span> tell us about how much of the variation in <span class="math inline">\(y\)</span> has been captured by the terms in the model. - The residual standard error is an estimate of <span class="math inline">\(\sigma\)</span> from the distribution of the <span class="math inline">\(\epsilon_i\)</span>.</p>
<p>However, <strong>all of that inference is dependent on the model being correct</strong>. If the linear model does not fit the data, then the <span class="math inline">\(\beta\)</span>’s are not meaningful, the variance cannot be estimated, we cannot correctly assess whether or not the covariate(s) x(’s) help to predict <span class="math inline">\(y\)</span></p>
</section>
<section id="anscombes-quartet" class="level2">
<h2 data-anchor-id="anscombes-quartet">Anscombe’s Quartet</h2>
<p>Recall Anscombe’s Quartet which we looked at last week. Recall that all of these models have identical summart statistics, and it turns out they all also have identical linear regression results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>datasets<span class="sc">::</span>anscombe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   x1 x2 x3 x4    y1   y2    y3    y4
1  10 10 10  8  8.04 9.14  7.46  6.58
2   8  8  8  8  6.95 8.14  6.77  5.76
3  13 13 13  8  7.58 8.74 12.74  7.71
4   9  9  9  8  8.81 8.77  7.11  8.84
5  11 11 11  8  8.33 9.26  7.81  8.47
6  14 14 14  8  9.96 8.10  8.84  7.04
7   6  6  6  8  7.24 6.13  6.08  5.25
8   4  4  4 19  4.26 3.10  5.39 12.50
9  12 12 12  8 10.84 9.13  8.15  5.56
10  7  7  7  8  4.82 7.26  6.42  7.91
11  5  5  5  8  5.68 4.74  5.73  6.89</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>long_ans <span class="ot">&lt;-</span> anscombe <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">everything</span>(),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols_vary =</span> <span class="st">"slowest"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"set"</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.)(.)"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(long_ans,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">group=</span>set))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="session6_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Only the top left plot among these four datasets represents a statistical regression model: - The top right model represents a non-linear relationship, and one that seems to have no error - The bottom left plot is a straight line, with one possible recording error, but no statistical variation - The bottom right plot shows no relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> for most points, but there is one <em>outlier</em>, in both <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> that affects the estimated relationship.</p>
<p>The hard part is not writing the command <code>lm(y~x)</code>. It is ensuring that the model adequately represents the data and the relationships within it Once you have convinced yourself, and others, that this is true then you can interpret and test hypotheses.</p>
</section>
<section id="evaluating-models" class="level2">
<h2 data-anchor-id="evaluating-models">Evaluating Models</h2>
<p>The residuals are defined as</p>
<p><span class="math display">\[
e_i = y_i - \hat{y}_i
\]</span></p>
<p>We can check the residuals for various behaviors to evaluate our model.</p>
<pre><code>1.  Constant spread: the $e_i$'s have about the same spread regardless of the value of $x$
2.  Independence: Do the $e_i$'s show any signs of correlation.
3.  Symmetry and Unimodality: Do the $e_i$'s have an approximately symmetric distribution with a single mode.
4.  Normality: but that is often too strong a requirement.</code></pre>
<section id="residual-plots" class="level3">
<h3 data-anchor-id="residual-plots">Residual Plots</h3>
<p>We can plot the residuals (<span class="math inline">\(y\)</span>-axis) against any covariates (<span class="math inline">\(x\)</span>’s) and the predicted values (<span class="math inline">\(\hat{y}\)</span>’s). We want to look for trends, such as increasing or decreasing variability (fans), and outliers. When data are collected over time, we sometimes look for relationships between successive residuals. We also want to be careful to not over-interpret data if we don’t have that much of it, as we saw last week when looking at insulin.</p>
<p>Let’s return to our child birth example and make a residual plot.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="session6_files/figure-html/residplots-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="extensions---non-linear-models" class="level2">
<h2 data-anchor-id="extensions---non-linear-models">Extensions - non-linear models</h2>
<p>So far we’ve only look at linear models. Fitting straight lines is fine, most of the time, as we know that complex relationships can be approximated by a straight line over a restricted set of values.</p>
<p>One option would be to add polynomials in our covariates</p>
<p><span class="math display">\[
    y = \beta_0 + \beta_1 \cdot x + \beta_2 \cdot x^2 + \epsilon
    \]</span> However, these models have very strong assumptions and the effect of the polynomial terms on the fit can be large.</p>
<p>Another option is an exponential model. A straight line model is appropriate if <span class="math inline">\(y\)</span> changes by a fixed amount for every unit change in <span class="math inline">\(x\)</span>. An exponential curve represents the case where <span class="math inline">\(y\)</span> changes by a fixed percentage (or proportion) for every unit change in <span class="math inline">\(x\)</span>. We often see exponential models in economics.</p>
<p>The exponential model can be defined as:</p>
<p><span class="math display">\[
     y = a \cdot e^{bx} \\
     ln(y) = ln(a) + b \cdot x
\]</span> Note that in the second equation, we’ve transformed the values by taking the natural log of both sides. Using this, we can fit an exponential model with linear regression if we <em>transform</em> <span class="math inline">\(y\)</span>. There are many other transformations of <span class="math inline">\(y\)</span> that could be used and an extensive literature on choosing the best ones (Box-Cox transformation). However, a transformation of <span class="math inline">\(y\)</span> will in general not just effect the mean relationship but it also affects the variability in your <span class="math inline">\(y\)</span> values as a function of <span class="math inline">\(x\)</span>.</p>
<p>Thus, the models are not the same. If we take a look again at the exponential function and transformed function, now labeled M1 and M2, note that we would need the error to be multiplicative in M1 for them to be the same.</p>
<p><span class="math display">\[
M1: y = a \cdot e^{bx} + \epsilon \\
M2: ln(y) = ln(a) + b \cdot x + \epsilon \\
\epsilon \sim N(0, \sigma^2)
  \]</span></p>
<p>We can visualize this difference as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fl">1.5</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fl">0.3</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">100</span>, <span class="dv">1</span>,<span class="dv">11</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>eps <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>m1v <span class="ot">=</span> a<span class="sc">*</span><span class="fu">exp</span>(b<span class="sc">*</span>x) <span class="sc">+</span> eps</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>m2v <span class="ot">=</span> <span class="fu">log</span>(a) <span class="sc">+</span> b<span class="sc">*</span>x <span class="sc">+</span> eps</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,m1v, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">xlab=</span><span class="st">"x"</span>, <span class="at">ylab=</span><span class="st">"y-hat"</span>, <span class="at">main=</span><span class="st">"M1"</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">log</span>(m1v), <span class="at">pch=</span><span class="dv">19</span>, <span class="at">xlab=</span><span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"log(y-hat)"</span>, <span class="at">main=</span><span class="st">"M1 transformed"</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,m2v, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">xlab=</span><span class="st">"x"</span>, <span class="at">ylab =</span><span class="st">"log(y)-hat"</span>, <span class="at">main=</span><span class="st">"M2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="session6_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="prediction-and-prediction-intervals" class="level2">
<h2 data-anchor-id="prediction-and-prediction-intervals">Prediction and Prediction intervals</h2>
<p>There are two kinds of predictions that are interesting:</p>
<pre><code>-   *Confidence interval*: predict the mean response for a given value of $x$
-   *Prediction interval*: predict the value of the response $y$ for an individual whose covariate is $x$</code></pre>
<p>Almost all regression methods in R have prediction methods associated with them. Confidence intervals have less variability than prediction intervals.</p>
<section id="example-confidence-interval-vs-prediction-interval" class="level3">
<h3 data-anchor-id="example-confidence-interval-vs-prediction-interval">Example: Confidence Interval vs Prediction Interval</h3>
<p>Returning to our example on infant death</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">=</span> <span class="fu">lm</span>(death<span class="sc">~</span>breast, <span class="at">data=</span>infdeath)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = death ~ breast, data = infdeath)

Residuals:
    Min      1Q  Median      3Q     Max 
-37.568 -21.047   1.368  19.479  33.705 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  -26.978     20.148  -1.339 0.205392    
breast         1.467      0.288   5.093 0.000265 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 23.86 on 12 degrees of freedom
  (6 observations deleted due to missingness)
Multiple R-squared:  0.6837,    Adjusted R-squared:  0.6573 
F-statistic: 25.94 on 1 and 12 DF,  p-value: 0.000265</code></pre>
</div>
</div>
<p>We can predict the mean response for country where 62% of the women breast feed at 6 months using the `predict1 function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(lm1, <span class="at">newdata=</span><span class="fu">list</span>(<span class="at">breast=</span><span class="dv">62</span>), <span class="at">interval=</span><span class="st">"confidence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit     lwr      upr
1 63.96593 49.8048 78.12705</code></pre>
</div>
</div>
<p>Or we can predict the response for a specific country where 62% of the women breast feed at 6 months</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(lm1, <span class="at">newdata=</span><span class="fu">list</span>(<span class="at">breast=</span><span class="dv">62</span>), <span class="at">interval=</span><span class="st">"prediction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 63.96593 10.08279 117.8491</code></pre>
</div>
</div>
<p>Note how the lower and upper bounds are much tighter for the confidence interval than for the prediction interval.</p>
</section>
</section>
<section id="regressions-using-factors" class="level2">
<h2 data-anchor-id="regressions-using-factors">Regressions using factors</h2>
<p>As we’ve seen, a <em>factor</em> is a variable that takes on a discrete set of different values. These values can be unordered (e.g.&nbsp;Male/Female or European, Asian, African, etc.) or they can be ordered (age: less than 18, 18-40, more than 40). In regression models, we typically implement factors using <em>dummy variables</em>. Essentially we create a new set of variables using indicator functions, <span class="math inline">\(1_{Ai} = 1\)</span> if observation <span class="math inline">\(i\)</span> has the level <span class="math inline">\(A\)</span>.</p>
<section id="fitting-factors-in-regression-models" class="level3">
<h3 data-anchor-id="fitting-factors-in-regression-models">Fitting factors in regression models</h3>
<p>Suppose we have a factor with <span class="math inline">\(K\)</span> levels We can fit factors in two ways</p>
<pre><code>-   **M1:** includes an intercept in the model and then use $K-1$ indicator variables
-   **M2L=:** no intercept and use $K$ indicator variables.</code></pre>
<p>In <strong>M1</strong> the intercept is the mean value of <span class="math inline">\(y\)</span>, and each <span class="math inline">\(\beta_j\)</span> is the difference in mean for the <span class="math inline">\(j^{th}\)</span> retained factor level from the overall mean. In <strong>M2</strong> each of the <span class="math inline">\(\beta_j\)</span> is the mean value for <span class="math inline">\(y\)</span> only within factor level <span class="math inline">\(j\)</span>.</p>
<p>To show an example, suppose our factor is sex, which has two levels, M and F. Our models could be</p>
<p><span class="math display">\[
  M1:  Y = \beta_0 + \beta_M \cdot 1_{M} + \epsilon \\
  E[Y | F]= \beta_0 \quad \mbox{and} \quad E[Y|M] = \beta_0 + \beta_M
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>heights <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">40</span>, <span class="at">min=</span><span class="dv">60</span>, <span class="at">max=</span><span class="dv">75</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"M"</span>,<span class="st">"F"</span>), <span class="dv">40</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">=</span> <span class="fu">lm</span>(heights <span class="sc">~</span> sex)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = heights ~ sex)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.7290 -3.4115  0.5925  3.7202  5.9065 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  68.0986     0.9463  71.966   &lt;2e-16 ***
sexM          0.2882     1.3060   0.221    0.827    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.125 on 38 degrees of freedom
Multiple R-squared:  0.00128,   Adjusted R-squared:  -0.025 
F-statistic: 0.04871 on 1 and 38 DF,  p-value: 0.8265</code></pre>
</div>
</div>
<p>Or</p>
<p><span class="math display">\[
  M2: y = \beta_M \cdot 1_{M} + \beta_{F} \cdot 1_{F} + \epsilon \\
  E[Y|F] = \beta_F \quad \mbox{and} E[Y|M] = \beta_M
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding -1 tells R that we don't want an intercept</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">=</span> <span class="fu">lm</span>(heights <span class="sc">~</span> sex <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = heights ~ sex - 1)

Residuals:
    Min      1Q  Median      3Q     Max 
-7.7290 -3.4115  0.5925  3.7202  5.9065 

Coefficients:
     Estimate Std. Error t value Pr(&gt;|t|)    
sexF  68.0986     0.9463   71.97   &lt;2e-16 ***
sexM  68.3868     0.9001   75.98   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.125 on 38 degrees of freedom
Multiple R-squared:  0.9965,    Adjusted R-squared:  0.9964 
F-statistic:  5476 on 2 and 38 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Note that there are some issues you have to worry about when fitting a model without an intercept. With model M1 that has an intercept then for each group the test for <span class="math inline">\(H_0: \beta_j = 0\)</span> tests whether that group mean is different from the mean for the group that was used to determine the intercept. However, in M2 the test for each group, <span class="math inline">\(H_0: \beta_j = 0\)</span> is then comparing the mean for that group to zero (0). In M2, multiple-<span class="math inline">\(R^2\)</span> does not have a reasonable interpretation, and we get a very high value.</p>
<hr>
<p>This materials loosely based on <em>Chance Encounters</em> by Seber and Wild <a href="https://www.stat.auckland.ac.nz/~wild/ChanceEnc/index.shtml" class="uri">https://www.stat.auckland.ac.nz/~wild/ChanceEnc/index.shtml</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>