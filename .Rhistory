mutate(perc_insulin = insulin/n)
tib_all |>
filter(diabetes == "diabetic") |>
group_by(DIQ050, birthplace) |>
summarize(n = n(), insulin = sum((DIQ050) == "Yes")) |>
mutate(perc_insulin = insulin/n)
tib_all |>
filter(diabetes == "diabetic") |>
group_by(birthplace, family.PIR.cat) |>
summarize(n = n(), insulin = sum((DIQ050) == "Yes")) |>
mutate(perc_insulin = insulin/n)
tib_all |>
filter(diabetes == "diabetic") |>
group_by(birthplace, family.PIR.cat, bmi.cat) |>
summarize(n = n(), insulin = sum((DIQ050) == "Yes")) |>
mutate(perc_insulin = insulin/n)
tib_all |>
filter(diabetes == "diabetic") |>
group_by(birthplace, family.PIR.cat) |>
summarize(n = n(), insulin = sum((DIQ050) == "Yes")) |>
mutate(perc_insulin = insulin/n)
tib_all |>
filter(diabetes == "diabetic") |>
group_by(ethnicity) |>
summarize(n = n(), insulin = sum((DIQ050) == "Yes")) |>
mutate(perc_insulin = insulin/n)
tib_all |>
filter(diabetes == "diabetic") |>
group_by(RIDETH1) |>
summarize(n = n(), insulin = sum((DIQ050) == "Yes")) |>
mutate(perc_insulin = insulin/n)
tib_all |>
filter(diabetes == "diabetic") |>
group_by(RIDRETH1) |>
summarize(n = n(), insulin = sum((DIQ050) == "Yes")) |>
mutate(perc_insulin = insulin/n)
tib_all |>
filter(diabetes == "diabetic") |>
group_by(RIDRETH1, birthplace) |>
summarize(n = n(), insulin = sum((DIQ050) == "Yes")) |>
mutate(perc_insulin = insulin/n)
insulin_tbl <- tib_all |>
filter(diabetes == "diabetic") |>
group_by(RIDRETH1, birthplace) |>
summarize(n = n(), insulin = sum((DIQ050) == "Yes")) |>
mutate(perc_insulin = insulin/n)
ggplot(tib_all, aes(x = RIDRETH1, y = perc_insulin)) + geom_bar()
ggplot(insulin_tbl, aes(x = RIDRETH1, y = perc_insulin)) + geom_bar()
ggplot(insulin_tbl, aes(x = RIDRETH1, y = perc_insulin)) + geom_bar(stat = "identity")
ggplot(insulin_tbl, aes(x = RIDRETH1, y = perc_insulin, fill = birthplace)) + geom_bar(stat = "identity")
ggplot(insulin_tbl, aes(x = birthplace, y = perc_insulin)) + geom_bar(stat = "identity") + facet_grid(~RIDRETH1)
ggplot(insulin_tbl, aes(x = birthplace, y = perc_insulin)) +
geom_bar(stat = "identity") +
facet_grid(~RIDRETH1)
quarto::quarto_render(output_format = "all")
quarto::quarto_render(output_format = "all")
quarto::quarto_render(output_format = "all")
quarto::quarto_render(output_format = "all")
#| output: false
#| warning: false
library(tidyverse)
library(survey)
library(DT)
library(flextable)
library(officer)
all_nhanes <- mutate(all_nhanes,
# Numeric Variables
LBXGLU = as.numeric(LBXGLU),
LBXGH = as.numeric(LBXGH),
BMXBMI = as.numeric(BMXBMI),
WTSAF2YR = as.numeric(WTSAF2YR),
WTINT2YR = as.numeric(WTINT2YR),
WTMEC2YR = as.numeric(WTMEC2YR),
SDMVPSU = as.numeric(SDMVPSU),
SDMVSTRA = as.numeric(SDMVSTRA),
RIDAGEYR = as.numeric(RIDAGEYR),
# Basic Categories
RIAGENDR = as.factor(RIAGENDR),
RIDRETH1 = as.factor(RIDRETH1),
DMDBORN = gsub("\"", "", DMDBORN),
DMDBORN = as.factor(DMDBORN),
OHXDECAY = (OHXDECAY == "Yes"),
OHXREST = (OHXREST == "Yes"),
#Complex Categories
age.cat = cut(
RIDAGEYR,
breaks = c(13, 15, 18, 100),
include.lowest = TRUE,
labels = c("13-15", "16-18", "19+")),
LBXGH.cat = case_when(
is.na(LBXGH) & is.na(LBXGLU) ~ NA,
LBXGH >= 6.5 | LBXGLU >= 126 ~ "diabetic",
LBXGH >= 5.7 | LBXGLU >= 100 ~ "prediabetic",
.default = "nondiabetic"),
RIDAGEYR.cat = cut(
RIDAGEYR,
breaks = c(13, 15, 18),
include.lowest = TRUE,
labels = c("13-15", "16-18")),
LBXGLU.cat = case_when(
LBXGLU < 100 ~ "<100 mg/dl",
LBXGLU < 126 ~ ">=100 mg/dl and <126 mg/dl",
LBXGLU >= 126 ~ ">=126 mg/dl",
.default = NA),
LBXGH.cat = case_when(
LBXGH < 5.7 ~ "<5.7%",
LBXGH >= 5.7 ~ ">=5.7% and <6.5%",
LBXGH >= 6.5 ~ ">= 6.5%",
.default = NA),
BMXBMI.cat = case_when(
BMXBMI < 25 ~ "Normal",
BMXBMI < 30 ~ "Overweight",
BMXBMI >= 30 ~ "Obese",
.default = NA),
INDFMPIR.cat = case_when(
INDFMPIR == "PIR value greater than or equa" ~ ">= 1",
INDFMPIR == "Value greater than or equal to" ~ ">= 1",
as.numeric(INDFMPIR) >= 1 ~ ">=1",
as.numeric(INDFMPIR) < 1 ~ "<1",
.default = NA),
DMDBORN.cat = case_when(
DMDBORN == "Born in 50 US States or Washi" ~ "Within the US",
is.na(DMDBORN) ~ NA,
DMDBORN == "Don't Know" ~ NA,
DMDBORN == "Refused" ~ NA,
.default = "Outside the US"),
dental.caries = OHXDECAY | OHXREST,
diabetes = case_when(
is.na(LBXGH) & is.na(LBXGLU) ~ NA,
LBXGH >= 6.5 | LBXGLU >= 126 ~ "diabetic",
LBXGH >= 5.7 | LBXGLU >= 100 ~ "prediabetic",
.default = "nondiabetic"))
#| output: false
#| warning: false
library(tidyverse)
library(survey)
library(DT)
library(flextable)
library(officer)
load(file.choose())
tib_d <- as_tibble(base_df_d)
tib_e <- as_tibble(base_df_e)
tib_f <- as_tibble(base_df_f)
tib_e <- rename(tib_e, DMDBORN = DMDBORN2)
tib_f <- rename(tib_f, DMDBORN = DMDBORN2)
# Combine all years together
tib_all <- tib_d %>%
bind_rows(tib_e) %>%
bind_rows(tib_f)
all_nhanes <- tib_all
all_nhanes <- mutate(all_nhanes,
# Numeric Variables
LBXGLU = as.numeric(LBXGLU),
LBXGH = as.numeric(LBXGH),
BMXBMI = as.numeric(BMXBMI),
WTSAF2YR = as.numeric(WTSAF2YR),
WTINT2YR = as.numeric(WTINT2YR),
WTMEC2YR = as.numeric(WTMEC2YR),
SDMVPSU = as.numeric(SDMVPSU),
SDMVSTRA = as.numeric(SDMVSTRA),
RIDAGEYR = as.numeric(RIDAGEYR),
# Basic Categories
RIAGENDR = as.factor(RIAGENDR),
RIDRETH1 = as.factor(RIDRETH1),
DMDBORN = gsub("\"", "", DMDBORN),
DMDBORN = as.factor(DMDBORN),
OHXDECAY = (OHXDECAY == "Yes"),
OHXREST = (OHXREST == "Yes"),
#Complex Categories
age.cat = cut(
RIDAGEYR,
breaks = c(13, 15, 18, 100),
include.lowest = TRUE,
labels = c("13-15", "16-18", "19+")),
LBXGH.cat = case_when(
is.na(LBXGH) & is.na(LBXGLU) ~ NA,
LBXGH >= 6.5 | LBXGLU >= 126 ~ "diabetic",
LBXGH >= 5.7 | LBXGLU >= 100 ~ "prediabetic",
.default = "nondiabetic"),
RIDAGEYR.cat = cut(
RIDAGEYR,
breaks = c(13, 15, 18),
include.lowest = TRUE,
labels = c("13-15", "16-18")),
LBXGLU.cat = case_when(
LBXGLU < 100 ~ "<100 mg/dl",
LBXGLU < 126 ~ ">=100 mg/dl and <126 mg/dl",
LBXGLU >= 126 ~ ">=126 mg/dl",
.default = NA),
LBXGH.cat = case_when(
LBXGH < 5.7 ~ "<5.7%",
LBXGH >= 5.7 ~ ">=5.7% and <6.5%",
LBXGH >= 6.5 ~ ">= 6.5%",
.default = NA),
BMXBMI.cat = case_when(
BMXBMI < 25 ~ "Normal",
BMXBMI < 30 ~ "Overweight",
BMXBMI >= 30 ~ "Obese",
.default = NA),
INDFMPIR.cat = case_when(
INDFMPIR == "PIR value greater than or equa" ~ ">= 1",
INDFMPIR == "Value greater than or equal to" ~ ">= 1",
as.numeric(INDFMPIR) >= 1 ~ ">=1",
as.numeric(INDFMPIR) < 1 ~ "<1",
.default = NA),
DMDBORN.cat = case_when(
DMDBORN == "Born in 50 US States or Washi" ~ "Within the US",
is.na(DMDBORN) ~ NA,
DMDBORN == "Don't Know" ~ NA,
DMDBORN == "Refused" ~ NA,
.default = "Outside the US"),
dental.caries = OHXDECAY | OHXREST,
diabetes = case_when(
is.na(LBXGH) & is.na(LBXGLU) ~ NA,
LBXGH >= 6.5 | LBXGLU >= 126 ~ "diabetic",
LBXGH >= 5.7 | LBXGLU >= 100 ~ "prediabetic",
.default = "nondiabetic"))
wt_nhanes <- wt_nhanes %>%
mutate(WTMEC6YR = WTMEC2YR * 1/3)
wt_nhanes <- all_nhanes #%>%
#drop_na(WTMEC2YR, SDMVPSU, SDMVSTRA)
wt_nhanes <- wt_nhanes %>%
mutate(WTMEC6YR = WTMEC2YR * 1/3)
write_csv(wt_nhanes, "nhanes_weights.csv")
getwd()
write_csv(select(wt_nhanes, WTMEC2YR, WTMEC6YR), "nhanes_weights.csv")
write_csv(select(wt_nhanes, SEQN, WTMEC2YR, WTMEC6YR), "nhanes_weights.csv")
load("nhanes_beheshti_data.RData")
write_csv(select(wt_nhanes, SEQN, WTMEC2YR, WTMEC6YR, SDMVPSU, SDMVSTRA), "nhanes_weights.csv")
quarto::quarto_render(output_format = "all")
quarto::quarto_render(output_format = "all")
#| output: false
#| warning: false
library(tidyverse)
library(survey)
library(DT)
library(flextable)
library(officer)
load("nhanes_beheshti_data.RData")
#| output: false
#| warning: false
library(tidyverse)
library(survey)
library(DT)
library(flextable)
library(officer)
load(file.choose())
file.choose()
base::file.choose()
sessionInfo()
choose.files()
tcltk::tk_choose.files()
getwd()
load("C:/Users/Chris/Documents/ccb/hsdm-r-course/session-materials/session4/nhanes_beheshti_data.RData")
tib_d <- as_tibble(base_df_d)
tib_e <- as_tibble(base_df_e)
tib_f <- as_tibble(base_df_f)
tib_e <- rename(tib_e, DMDBORN = DMDBORN2)
tib_f <- rename(tib_f, DMDBORN = DMDBORN2)
# Combine all years together
tib_all <- tib_d %>%
bind_rows(tib_e) %>%
bind_rows(tib_f)
all_nhanes <- tib_all
all_nhanes <- mutate(all_nhanes,
# Numeric Variables
LBXGLU = as.numeric(LBXGLU),
LBXGH = as.numeric(LBXGH),
BMXBMI = as.numeric(BMXBMI),
WTSAF2YR = as.numeric(WTSAF2YR),
WTINT2YR = as.numeric(WTINT2YR),
WTMEC2YR = as.numeric(WTMEC2YR),
SDMVPSU = as.numeric(SDMVPSU),
SDMVSTRA = as.numeric(SDMVSTRA),
RIDAGEYR = as.numeric(RIDAGEYR),
# Basic Categories
RIAGENDR = as.factor(RIAGENDR),
RIDRETH1 = as.factor(RIDRETH1),
DMDBORN = gsub("\"", "", DMDBORN),
DMDBORN = as.factor(DMDBORN),
OHXDECAY = (OHXDECAY == "Yes"),
OHXREST = (OHXREST == "Yes"),
#Complex Categories
age.cat = cut(
RIDAGEYR,
breaks = c(13, 15, 18, 100),
include.lowest = TRUE,
labels = c("13-15", "16-18", "19+")),
LBXGH.cat = case_when(
is.na(LBXGH) & is.na(LBXGLU) ~ NA,
LBXGH >= 6.5 | LBXGLU >= 126 ~ "diabetic",
LBXGH >= 5.7 | LBXGLU >= 100 ~ "prediabetic",
.default = "nondiabetic"),
RIDAGEYR.cat = cut(
RIDAGEYR,
breaks = c(13, 15, 18),
include.lowest = TRUE,
labels = c("13-15", "16-18")),
LBXGLU.cat = case_when(
LBXGLU < 100 ~ "<100 mg/dl",
LBXGLU < 126 ~ ">=100 mg/dl and <126 mg/dl",
LBXGLU >= 126 ~ ">=126 mg/dl",
.default = NA),
LBXGH.cat = case_when(
LBXGH < 5.7 ~ "<5.7%",
LBXGH >= 5.7 ~ ">=5.7% and <6.5%",
LBXGH >= 6.5 ~ ">= 6.5%",
.default = NA),
BMXBMI.cat = case_when(
BMXBMI < 25 ~ "Normal",
BMXBMI < 30 ~ "Overweight",
BMXBMI >= 30 ~ "Obese",
.default = NA),
INDFMPIR.cat = case_when(
INDFMPIR == "PIR value greater than or equa" ~ ">= 1",
INDFMPIR == "Value greater than or equal to" ~ ">= 1",
as.numeric(INDFMPIR) >= 1 ~ ">=1",
as.numeric(INDFMPIR) < 1 ~ "<1",
.default = NA),
DMDBORN.cat = case_when(
DMDBORN == "Born in 50 US States or Washi" ~ "Within the US",
is.na(DMDBORN) ~ NA,
DMDBORN == "Don't Know" ~ NA,
DMDBORN == "Refused" ~ NA,
.default = "Outside the US"),
dental.caries = OHXDECAY | OHXREST,
diabetes = case_when(
is.na(LBXGH) & is.na(LBXGLU) ~ NA,
LBXGH >= 6.5 | LBXGLU >= 126 ~ "diabetic",
LBXGH >= 5.7 | LBXGLU >= 100 ~ "prediabetic",
.default = "nondiabetic"))
#| output: false
#| warning: false
library(tidyverse)
library(survey)
library(DT)
library(flextable)
library(officer)
load("C:/Users/Chris/Documents/ccb/hsdm-r-course/session-materials/session4/nhanes_beheshti_data.RData")
tib_d <- as_tibble(base_df_d)
tib_e <- as_tibble(base_df_e)
tib_f <- as_tibble(base_df_f)
tib_e <- rename(tib_e, DMDBORN = DMDBORN2)
tib_f <- rename(tib_f, DMDBORN = DMDBORN2)
# Combine all years together
tib_all <- tib_d %>%
bind_rows(tib_e) %>%
bind_rows(tib_f)
all_nhanes <- tib_all
all_nhanes <- mutate(all_nhanes,
# Numeric Variables
LBXGLU = as.numeric(LBXGLU),
LBXGH = as.numeric(LBXGH),
BMXBMI = as.numeric(BMXBMI),
WTSAF2YR = as.numeric(WTSAF2YR),
WTINT2YR = as.numeric(WTINT2YR),
WTMEC2YR = as.numeric(WTMEC2YR),
SDMVPSU = as.numeric(SDMVPSU),
SDMVSTRA = as.numeric(SDMVSTRA),
RIDAGEYR = as.numeric(RIDAGEYR),
# Basic Categories
RIAGENDR = as.factor(RIAGENDR),
RIDRETH1 = as.factor(RIDRETH1),
DMDBORN = gsub("\"", "", DMDBORN),
DMDBORN = as.factor(DMDBORN),
OHXDECAY = (OHXDECAY == "Yes"),
OHXREST = (OHXREST == "Yes"),
#Complex Categories
age.cat = cut(
RIDAGEYR,
breaks = c(13, 15, 18, 100),
include.lowest = TRUE,
labels = c("13-15", "16-18", "19+")),
LBXGH.cat = case_when(
is.na(LBXGH) & is.na(LBXGLU) ~ NA,
LBXGH >= 6.5 | LBXGLU >= 126 ~ "diabetic",
LBXGH >= 5.7 | LBXGLU >= 100 ~ "prediabetic",
.default = "nondiabetic"),
RIDAGEYR.cat = cut(
RIDAGEYR,
breaks = c(13, 15, 18),
include.lowest = TRUE,
labels = c("13-15", "16-18")),
LBXGLU.cat = case_when(
LBXGLU < 100 ~ "<100 mg/dl",
LBXGLU < 126 ~ ">=100 mg/dl and <126 mg/dl",
LBXGLU >= 126 ~ ">=126 mg/dl",
.default = NA),
LBXGH.cat = case_when(
LBXGH < 5.7 ~ "<5.7%",
LBXGH >= 5.7 ~ ">=5.7% and <6.5%",
LBXGH >= 6.5 ~ ">= 6.5%",
.default = NA),
BMXBMI.cat = case_when(
BMXBMI < 25 ~ "Normal",
BMXBMI < 30 ~ "Overweight",
BMXBMI >= 30 ~ "Obese",
.default = NA),
INDFMPIR.cat = case_when(
INDFMPIR == "PIR value greater than or equa" ~ ">= 1",
INDFMPIR == "Value greater than or equal to" ~ ">= 1",
as.numeric(INDFMPIR) >= 1 ~ ">=1",
as.numeric(INDFMPIR) < 1 ~ "<1",
.default = NA),
DMDBORN.cat = case_when(
DMDBORN == "Born in 50 US States or Washi" ~ "Within the US",
is.na(DMDBORN) ~ NA,
DMDBORN == "Don't Know" ~ NA,
DMDBORN == "Refused" ~ NA,
.default = "Outside the US"),
dental.caries = OHXDECAY | OHXREST,
diabetes = case_when(
is.na(LBXGH) & is.na(LBXGLU) ~ NA,
LBXGH >= 6.5 | LBXGLU >= 126 ~ "diabetic",
LBXGH >= 5.7 | LBXGLU >= 100 ~ "prediabetic",
.default = "nondiabetic"))
wt_nhanes <- all_nhanes %>%
drop_na(WTMEC2YR, SDMVPSU, SDMVSTRA)
##try de-tidying it to see if we can get the models to behave
wt_nhanes <- wt_nhanes %>%
mutate(WTMEC6YR = WTMEC2YR * 1/3)
wt_nhanes=data.frame(wt_nhanes)
wt_nhanes$diabetes = factor(wt_nhanes$diabetes, levels=c("nondiabetic","prediabetic","diabetic"))
nhanes_design <- svydesign(id     = ~SDMVPSU,
strata  = ~SDMVSTRA,
weights = ~WTMEC6YR,
nest    = TRUE,
survey.lonely.psu = "adjust",
data    = wt_nhanes)
summary(nhanes_design)
ado_design <- subset(nhanes_design, RIDAGEYR >= 13 & RIDAGEYR <= 18 & !is.na(OHXDECAY))
#Also make a tibble of this data to analyze
ado_data <- wt_nhanes %>%
filter(RIDAGEYR >= 13 & RIDAGEYR <= 18) %>% # Gets the 3660 nonedentulous adolescents
filter(!is.na(OHXDECAY)) %>% # Gets the 3346 with non-NA dental carie variable
filter(!is.na(diabetes)) # Gets the 3046 with a diabetic status
tab1 = svytable(~age.cat + dental.caries, ado_design)
round(tab1[1,]/sum(tab1[1,]), digits=3)
round(tab1[2,]/sum(tab1[2,]), digits=3)
svytable(~RIDRETH1, ado_design)
# Model 1: Unadjusted
logit1 <- svyglm(dental.caries~ diabetes, family=quasibinomial, design=ado_design, na.action = na.omit)
exp(coef(logit1))
summary(logit1)
# Model 2: Controlled for age, race/ethnicity, gender
logit2 <- svyglm(dental.caries~ diabetes + RIDRETH1 + RIAGENDR + RIDAGEYR, family=quasibinomial, design=ado_design, na.action = na.omit)
exp(coef(logit2))
summary(logit2)
# Model 3: Controlled for age, race/ethnicity, gender, BMI
logit3 <- svyglm(dental.caries~ diabetes + RIDRETH1 + RIAGENDR + RIDAGEYR + BMXBMI, family=quasibinomial, design=ado_design, na.action = na.omit)
summary(logit3)
# Model 4: Controlled for age, race/ethnicity, gender, BMI, and family income-to-poverty ratio
# Model 5: Controlled for age, race/ethnicity, gender, BMI, family income-to-poverty ratio, and country of birth
quarto::quarto_render(output_format = "all")
#| echo: false
#| message: false
library(tidyverse)
library(reactable)
library(reactablefmtr)
# Load schedule
sched <- read_csv("schedule.csv")
reactable(select(sched, `Module Week`, `Instructor Training July Session Date`, `Class Session Date`), theme = flatly(), sortable = FALSE)
#| echo: false
#| message: false
library(tidyverse)
library(reactable)
library(reactablefmtr)
# Load schedule
sched <- read_csv("schedule.csv")
reactable(select(sched, `Module`, `Class Session Date`), theme = flatly(), sortable = FALSE)
#| echo: false
#| message: false
library(tidyverse)
library(reactable)
library(reactablefmtr)
# Load schedule
sched <- read_csv("schedule.csv")
reactable(select(sched, `Module Week`, `Class Session Date`), theme = flatly(), sortable = FALSE)
#| echo: false
#| message: false
library(tidyverse)
library(reactable)
library(reactablefmtr)
# Load schedule
sched <- read_csv("schedule.csv")
reactable(select(sched, `Module Week`, `Instructor Training July Session Date`, `Class Session Date`), theme = flatly(), sortable = FALSE)
View(sched)
#| echo: false
#| message: false
library(tidyverse)
library(reactable)
library(reactablefmtr)
# Load schedule
sched <- read_csv("schedule.csv")
reactable(select(sched, `Module`,  `Class Session Date`), theme = flatly(), sortable = FALSE)
#| echo: false
#| message: false
library(tidyverse)
library(reactable)
library(reactablefmtr)
# Load schedule
sched <- read_csv("schedule.csv")
sched$`Class Session Date` <-
reactable(select(sched, `Module`,  `Class Session Date`), theme = flatly(), sortable = FALSE)
#| echo: false
#| message: false
library(tidyverse)
library(reactable)
library(reactablefmtr)
# Load schedule
sched <- read_csv("schedule.csv")
reactable(select(sched, `Module`,  `Class Session Date`), theme = flatly(), sortable = FALSE)
